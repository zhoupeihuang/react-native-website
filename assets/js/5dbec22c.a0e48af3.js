"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[84204],{35318:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var a=n(27378);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(n),c=o,f=m["".concat(s,".").concat(c)]||m[c]||d[c]||r;return n?a.createElement(f,i(i({ref:t},u),{},{components:n})):a.createElement(f,i({ref:t},u))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},11674:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(63445);const o=!!a.Z.canUseDOM&&navigator.platform.startsWith("Mac"),r=!!a.Z.canUseDOM&&navigator.platform.startsWith("Win"),i={defaultGuide:"native",defaultOs:o?"macos":r?"windows":"linux",defaultPackageManager:"npm",defaultPlatform:o?"ios":"android",defaultSyntax:"functional",getDevNotesTabs:(e=["android","ios","web","windows"])=>[e.includes("android")?{label:"Android",value:"android"}:void 0,e.includes("ios")?{label:"iOS",value:"ios"}:void 0,e.includes("web")?{label:"Web",value:"web"}:void 0,e.includes("windows")?{label:"Windows",value:"windows"}:void 0].filter(Boolean),guides:[{label:"\u5b8c\u6574\u539f\u751f\u73af\u5883",value:"native"},{label:"\u7b80\u6613\u6c99\u76d2\u73af\u5883",value:"quickstart"}],oses:[{label:"macOS",value:"macos"},{label:"Windows",value:"windows"},{label:"Linux",value:"linux"}],packageManagers:[{label:"npm",value:"npm"},{label:"Yarn",value:"yarn"}],platforms:[{label:"Android",value:"android"},{label:"iOS",value:"ios"}],syntax:[{label:"\u51fd\u6570\u5f0f\u7ec4\u4ef6",value:"functional"},{label:"Class \u7ec4\u4ef6",value:"classical"}]}},86386:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(27378),o=n(38944);const r="tabItem_wHwb";var i=Object.defineProperty,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function d({children:e,hidden:t,className:n}){return a.createElement("div",((e,t)=>{for(var n in t||(t={}))s.call(t,n)&&u(e,n,t[n]);if(l)for(var n of l(t))p.call(t,n)&&u(e,n,t[n]);return e})({role:"tabpanel",className:(0,o.Z)(r,n)},{hidden:t}),e)}},48375:(e,t,n)=>{n.d(t,{Z:()=>_});var a=n(27378),o=n(38944),r=n(12112),i=n(35331),l=n(14953),s=n(27886),p=n(7106),u=Object.defineProperty,d=Object.defineProperties,m=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,g=(e,t,n)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function h(e){return function(e){return a.Children.map(e,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((({props:{value:e,label:t,attributes:n,default:a}})=>({value:e,label:t,attributes:n,default:a})))}function y(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=null!=t?t:h(n);return function(e){const t=(0,s.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function N({value:e,tabValues:t}){return t.some((t=>t.value===e))}function b({queryString:e=!1,groupId:t}){const n=(0,i.k6)(),o=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:e,groupId:t});return[(0,l._X)(o),(0,a.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(n.location.search);var a,r;t.set(o,e),n.replace((a=((e,t)=>{for(var n in t||(t={}))f.call(t,n)&&g(e,n,t[n]);if(c)for(var n of c(t))v.call(t,n)&&g(e,n,t[n]);return e})({},n.location),r={search:t.toString()},d(a,m(r))))}),[o,n])]}function k(e){const{defaultValue:t,queryString:n=!1,groupId:o}=e,r=y(e),[i,l]=(0,a.useState)((()=>function({defaultValue:e,tabValues:t}){var n;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!N({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const a=null!=(n=t.find((e=>e.default)))?n:t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:r}))),[s,u]=b({queryString:n,groupId:o}),[d,m]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,o]=(0,p.Nk)(t);return[n,(0,a.useCallback)((e=>{t&&o.set(e)}),[t,o])]}({groupId:o}),c=(()=>{const e=null!=s?s:d;return N({value:e,tabValues:r})?e:null})();(0,a.useLayoutEffect)((()=>{c&&l(c)}),[c]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!N({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),m(e)}),[u,m,r]),tabValues:r}}var w=n(14185);const C="tabList_J5MA",T="tabItem_l0OV";var M=Object.defineProperty,P=Object.defineProperties,S=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,I=(e,t,n)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,j=(e,t)=>{for(var n in t||(t={}))R.call(t,n)&&I(e,n,t[n]);if(O)for(var n of O(t))x.call(t,n)&&I(e,n,t[n]);return e};function V({className:e,block:t,selectedValue:n,selectValue:i,tabValues:l}){const s=[],{blockElementScrollPositionUntilNextRender:p}=(0,r.o5)(),u=e=>{const t=e.currentTarget,a=s.indexOf(t),o=l[a].value;o!==n&&(p(t),i(o))},d=e=>{var t,n;let a=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=s.indexOf(e.currentTarget)+1;a=null!=(t=s[n])?t:s[0];break}case"ArrowLeft":{const t=s.indexOf(e.currentTarget)-1;a=null!=(n=s[t])?n:s[s.length-1];break}}null==a||a.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":t},e)},l.map((({value:e,label:t,attributes:r})=>{return a.createElement("li",(i=j({role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,key:e,ref:e=>s.push(e),onKeyDown:d,onClick:u},r),l={className:(0,o.Z)("tabs__item",T,null==r?void 0:r.className,{"tabs__item--active":n===e})},P(i,S(l))),null!=t?t:e);var i,l})))}function E({lazy:e,children:t,selectedValue:n}){if(t=Array.isArray(t)?t:[t],e){const e=t.find((e=>e.props.value===n));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},t.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function A(e){const t=k(e);return a.createElement("div",{className:(0,o.Z)("tabs-container",C)},a.createElement(V,j(j({},e),t)),a.createElement(E,j(j({},e),t)))}function _(e){const t=(0,w.Z)();return a.createElement(A,j({key:String(t)},e))}},38286:(e,t,n)=>{n.d(t,{ZP:()=>c});var a=n(35318),o=Object.defineProperty,r=Object.defineProperties,i=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(e,t,n)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,d=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&u(e,n,t[n]);if(l)for(var n of l(t))p.call(t,n)&&u(e,n,t[n]);return e};const m={toc:[]};function c(e){var t,n=e,{components:o}=n,u=((e,t)=>{var n={};for(var a in e)s.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&l)for(var a of l(e))t.indexOf(a)<0&&p.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=d(d({},m),u),r(t,i({components:o,mdxType:"MDXLayout"}))),(0,a.kt)("admonition",d({},{title:"\u6ce8\u610f",type:"caution"}),(0,a.kt)("p",{parentName:"admonition"},"\u8fd9\u4e2a\u6587\u6863\u4ecd\u7136\u662f",(0,a.kt)("strong",{parentName:"p"},"\u5b9e\u9a8c\u6027"),"\u7684\uff0c\u968f\u7740\u6211\u4eec\u7684\u8fed\u4ee3\uff0c\u7ec6\u8282\u4f1a\u6709\u53d8\u5316\u3002\u6b22\u8fce\u5728",(0,a.kt)("a",d({parentName:"p"},{href:"https://github.com/reactwg/react-native-new-architecture/discussions/8"}),"\u5de5\u4f5c\u5c0f\u7ec4\u5185\u7684\u8ba8\u8bba"),"\u4e2d\u5206\u4eab\u4f60\u7684\u53cd\u9988\u3002"),(0,a.kt)("p",{parentName:"admonition"},"\u6b64\u5916\uff0c\u5b83\u8fd8\u5305\u542b\u51e0\u4e2a",(0,a.kt)("strong",{parentName:"p"},"\u624b\u52a8\u6b65\u9aa4"),"\u3002\u8bf7\u6ce8\u610f\u65b0\u67b6\u6784\u5c1a\u672a\u7a33\u5b9a\u4e0b\u6765\uff0c\u6700\u7ec8\u7684\u5f00\u53d1\u8005\u4f53\u9a8c\u4f1a\u7ee7\u7eed\u8fed\u4ee3\u6539\u5584\u3002\u6211\u4eec\u6b63\u5728\u52aa\u529b\u5f00\u53d1\u5de5\u5177\u3001\u6a21\u677f\u548c\u5e93\uff0c\u4ee5\u5e2e\u52a9\u4f60\u5728\u65b0\u67b6\u6784\u4e0a\u5feb\u901f\u5165\u95e8\uff0c\u800c\u4e0d\u9700\u8981\u7ecf\u5386\u6574\u4e2a\u8bbe\u7f6e\u8fc7\u7a0b\u3002")))}c.isMDXComponent=!0},58447:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>N,contentTitle:()=>h,default:()=>w,frontMatter:()=>g,metadata:()=>y,toc:()=>b});var a=n(35318),o=n(48375),r=n(86386),i=n(11674),l=n(38286),s=Object.defineProperty,p=Object.defineProperties,u=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,f=(e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,v=(e,t)=>{for(var n in t||(t={}))m.call(t,n)&&f(e,n,t[n]);if(d)for(var n of d(t))c.call(t,n)&&f(e,n,t[n]);return e};const g={id:"new-architecture-library-intro",title:"\u5728\u5e93\u4e2d\u542f\u7528\u7684\u9884\u5907\u5de5\u4f5c"},h=void 0,y={unversionedId:"new-architecture-library-intro",id:"new-architecture-library-intro",title:"\u5728\u5e93\u4e2d\u542f\u7528\u7684\u9884\u5907\u5de5\u4f5c",description:"The following steps will help ensure your modules and components are ready for the New Architecture.",source:"@site/../cndocs/new-architecture-library-intro.md",sourceDirName:".",slug:"/new-architecture-library-intro",permalink:"/docs/next/new-architecture-library-intro",draft:!1,editUrl:"https://github.com/reactnativecn/react-native-website/blob/production/cnwebsite/../cndocs/new-architecture-library-intro.md",tags:[],version:"current",frontMatter:{id:"new-architecture-library-intro",title:"\u5728\u5e93\u4e2d\u542f\u7528\u7684\u9884\u5907\u5de5\u4f5c"},sidebar:"docs",previous:{title:"\u8fc1\u79fb\u5230\u65b0\u67b6\u6784",permalink:"/docs/next/new-architecture-intro"},next:{title:"\u5728 Android \u5e93\u4e2d\u542f\u7528",permalink:"/docs/next/new-architecture-library-android"}},N={},b=[{value:"Define Specs in JavaScript",id:"define-specs-in-javascript",level:2},{value:"Turbo Native Modules",id:"turbo-native-modules",level:4},{value:"Fabric Native Components",id:"fabric-native-components",level:4},{value:"Supported Types",id:"supported-types",level:3},{value:"Codegen Helper Types",id:"codegen-helper-types",level:3},{value:"Be Consistent Across Platforms and Eliminate Type Ambiguity",id:"be-consistent-across-platforms-and-eliminate-type-ambiguity",level:3},{value:"Make Sure <em>autolinking</em> is Enabled",id:"make-sure-autolinking-is-enabled",level:2},{value:"Android",id:"android",level:3},{value:"iOS",id:"ios",level:3},{value:"Configure Codegen",id:"configure-codegen",level:2},{value:"Migrating from <code>UIManager</code> JavaScript APIs",id:"migrating-from-uimanager-javascript-apis",level:2},{value:"Migrating off <code>setNativeProps</code>",id:"migrating-off-setnativeprops",level:3},{value:"Pre-Fabric, Component Props Persist",id:"pre-fabric-component-props-persist",level:4},{value:"Moving <code>setNativeProps</code> to state",id:"moving-setnativeprops-to-state",level:4},{value:"Move the call to <code>requireNativeComponent</code> to a separate file",id:"move-the-call-to-requirenativecomponent-to-a-separate-file",level:3},{value:"Old way",id:"old-way",level:4},{value:"New way",id:"new-way",level:4},{value:"Flow support",id:"flow-support",level:4},{value:"Later on you can replace <code>requireNativeComponent</code>",id:"later-on-you-can-replace-requirenativecomponent",level:4},{value:"Migrating off <code>dispatchViewManagerCommand</code>",id:"migrating-off-dispatchviewmanagercommand",level:3},{value:"Using Your Command",id:"using-your-command",level:4},{value:"Updating Native Implementation",id:"updating-native-implementation",level:4}],k={toc:b};function w(e){var t,n=e,{components:s}=n,f=((e,t)=>{var n={};for(var a in e)m.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&d)for(var a of d(e))t.indexOf(a)<0&&c.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=v(v({},k),f),p(t,u({components:s,mdxType:"MDXLayout"}))),(0,a.kt)(l.ZP,{mdxType:"NewArchitectureWarning"}),(0,a.kt)("p",null,"The following steps will help ensure your modules and components are ready for the New Architecture."),(0,a.kt)("h2",v({},{id:"define-specs-in-javascript"}),"Define Specs in JavaScript"),(0,a.kt)("p",null,"The JavaScript specs serve as the source of truth for the methods provided by each native module. They define all APIs provided by the native module, along with the types of those constants and functions.\nUsing a ",(0,a.kt)("strong",{parentName:"p"},"typed")," spec file allows you to be intentional and declare all the input arguments and outputs of your native module\u2019s methods."),(0,a.kt)("admonition",v({},{type:"info"}),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("strong",{parentName:"p"},"TypeScript")," support is in beta right now.")),(0,a.kt)("p",null,"To adopt the New Architecture, you start by creating these specs for your native modules and native components. You can do this before migrating to the New Architecture: the specs will be used later on to generate native interface code for all the supported platforms as a way to enforce uniform APIs across platforms."),(0,a.kt)("h4",v({},{id:"turbo-native-modules"}),"Turbo Native Modules"),(0,a.kt)("p",null,"JavaScript spec files ",(0,a.kt)("strong",{parentName:"p"},"must")," be named ",(0,a.kt)("inlineCode",{parentName:"p"},"Native<MODULE_NAME>.js"),", and they export a ",(0,a.kt)("inlineCode",{parentName:"p"},"TurboModuleRegistry")," ",(0,a.kt)("inlineCode",{parentName:"p"},"Spec")," object. The name convention is important because the Codegen process looks for modules whose ",(0,a.kt)("inlineCode",{parentName:"p"},"js")," (",(0,a.kt)("inlineCode",{parentName:"p"},"jsx"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"ts"),", or ",(0,a.kt)("inlineCode",{parentName:"p"},"tsx"),") spec file starts with the keyword ",(0,a.kt)("inlineCode",{parentName:"p"},"Native"),"."),(0,a.kt)("p",null,"The following is a basic JavaScript spec template, written using the ",(0,a.kt)("a",v({parentName:"p"},{href:"https://flow.org/"}),"Flow")," and ",(0,a.kt)("a",v({parentName:"p"},{href:"https://www.typescriptlang.org/"}),"TypeScript")," syntax."),(0,a.kt)(o.Z,{groupId:"fabric-component-backward-compatibility",defaultValue:i.Z.defaultFabricComponentSpecLanguage,values:i.Z.fabricComponentSpecLanguages,mdxType:"Tabs"},(0,a.kt)(r.Z,{value:"Flow",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-ts"}),"// @flow\n\nimport type {TurboModule} from 'react-native/Libraries/TurboModule/RCTExport';\nimport {TurboModuleRegistry} from 'react-native';\n\nexport interface Spec extends TurboModule {\n  +getConstants: () => {||};\n\n  // your module methods go here, for example:\n  getString(id: string): Promise<string>;\n}\n\nexport default (TurboModuleRegistry.get<Spec>('<MODULE_NAME>'): ?Spec);\n"))),(0,a.kt)(r.Z,{value:"TypeScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-ts"}),"import type {TurboModule} from 'react-native';\nimport {TurboModuleRegistry} from 'react-native';\n\nexport interface Spec extends TurboModule {\n  readonly getConstants: () => {};\n\n  // your module methods go here, for example:\n  getString(id: string): Promise<string>;\n}\n\nexport default TurboModuleRegistry.get<Spec>('<MODULE_NAME>');\n")))),(0,a.kt)("h4",v({},{id:"fabric-native-components"}),"Fabric Native Components"),(0,a.kt)("p",null,"JavaScript spec files ",(0,a.kt)("strong",{parentName:"p"},"must")," be named ",(0,a.kt)("inlineCode",{parentName:"p"},"<FABRIC COMPONENT>NativeComponent.js")," (for TypeScript use extension ",(0,a.kt)("inlineCode",{parentName:"p"},".ts")," or ",(0,a.kt)("inlineCode",{parentName:"p"},".tsx"),") and they export a ",(0,a.kt)("inlineCode",{parentName:"p"},"HostComponent")," object. The name convention is important: the Codegen process looks for components whose spec file (either JavaScript or TypeScript) ends with the suffix ",(0,a.kt)("inlineCode",{parentName:"p"},"NativeComponent"),"."),(0,a.kt)("p",null,"The following snippet shows a basic JavaScript spec template, written in ",(0,a.kt)("a",v({parentName:"p"},{href:"https://flow.org/"}),"Flow")," as well as ",(0,a.kt)("a",v({parentName:"p"},{href:"https://www.typescriptlang.org/"}),"TypeScript"),"."),(0,a.kt)(o.Z,{groupId:"fabric-component-backward-compatibility",defaultValue:i.Z.defaultFabricComponentSpecLanguage,values:i.Z.fabricComponentSpecLanguages,mdxType:"Tabs"},(0,a.kt)(r.Z,{value:"Flow",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-ts"}),"// @flow strict-local\n\nimport type {ViewProps} from 'react-native/Libraries/Components/View/ViewPropTypes';\nimport type {HostComponent} from 'react-native';\nimport codegenNativeComponent from 'react-native/Libraries/Utilities/codegenNativeComponent';\n\ntype NativeProps = $ReadOnly<{|\n  ...ViewProps,\n  // add other props here\n|}>;\n\nexport default (codegenNativeComponent<NativeProps>(\n   '<FABRIC COMPONENT>',\n): HostComponent<NativeProps>);\n"))),(0,a.kt)(r.Z,{value:"TypeScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-ts"}),"import type {ViewProps} from 'ViewPropTypes';\nimport type {HostComponent} from 'react-native';\nimport codegenNativeComponent from 'react-native/Libraries/Utilities/codegenNativeComponent';\n\nexport interface NativeProps extends ViewProps {\n  // add other props here\n}\n\nexport default codegenNativeComponent<NativeProps>(\n  '<FABRIC COMPONENT>',\n) as HostComponent<NativeProps>;\n")))),(0,a.kt)("h3",v({},{id:"supported-types"}),"Supported Types"),(0,a.kt)("p",null,"When using Flow or TypeScript, you will be using ",(0,a.kt)("a",v({parentName:"p"},{href:"https://flow.org/en/docs/types/"}),"type annotations")," to define your spec. Keeping in mind that the goal of defining a JavaScript spec is to ensure the generated native interface code is type-safe, the set of supported types will be those that can be mapped one-to-one to a corresponding type on the native platform."),(0,a.kt)("p",null,"In general, this means you can use primitive types (strings, numbers, booleans), function types, object types, and array types. Union types, on the other hand, are not supported. All types must be read-only. For Flow: either ",(0,a.kt)("inlineCode",{parentName:"p"},"+")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"$ReadOnly<>")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"{||}")," objects. For TypeScript: ",(0,a.kt)("inlineCode",{parentName:"p"},"readonly")," for properties, ",(0,a.kt)("inlineCode",{parentName:"p"},"Readonly<>")," for objects, and ",(0,a.kt)("inlineCode",{parentName:"p"},"ReadonlyArray<>")," for arrays."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"See Appendix ",(0,a.kt)("a",v({parentName:"p"},{href:"new-architecture-appendix#ii-flow-type-to-native-type-mapping"}),"II. Flow Type to Native Type Mapping"),".\nSee Appendix ",(0,a.kt)("a",v({parentName:"p"},{href:"new-architecture-appendix#iii-typescript-to-native-type-mapping"}),"III. TypeScript to Native Type Mapping"),".")),(0,a.kt)("h3",v({},{id:"codegen-helper-types"}),"Codegen Helper Types"),(0,a.kt)("p",null,"You can use predefined types for your JavaScript spec, here is a list of them:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Double")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Float")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Int32")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"WithDefault<Type, Value>")," - Sets default value for type"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"BubblingEventHandler<T>")," - For bubbling events (eg: ",(0,a.kt)("inlineCode",{parentName:"li"},"onChange"),")."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"DirectEventHandler<T>")," - For direct events (eg: ",(0,a.kt)("inlineCode",{parentName:"li"},"onClick"),").")),(0,a.kt)("p",null,"Later on those types are compiled to coresponding equivalents on target platforms."),(0,a.kt)("h3",v({},{id:"be-consistent-across-platforms-and-eliminate-type-ambiguity"}),"Be Consistent Across Platforms and Eliminate Type Ambiguity"),(0,a.kt)("p",null,"Before adopting the New Architecture in your native module, you should ensure your methods are consistent across platforms. You will realize this as you set out to write the JavaScript spec for your native module - remember that JavaScript spec defines what the methods will look like on all supported platforms."),(0,a.kt)("p",null,"If your existing native module has methods with the same name on multiple platforms, but with different numbers or types of arguments across platforms, you will need to find a way to make these consistent. If you have methods that can take two or more different types for the same argument, then you need to find a way to resolve this type of ambiguity as type unions are intentionally not supported."),(0,a.kt)("h2",v({},{id:"make-sure-autolinking-is-enabled"}),"Make Sure ",(0,a.kt)("em",{parentName:"h2"},"autolinking")," is Enabled"),(0,a.kt)("p",null,(0,a.kt)("a",v({parentName:"p"},{href:"https://github.com/react-native-community/cli/blob/master/docs/autolinking.md"}),"Autolinking")," is a feature of the React Native CLI that simplifies the installation of third-party React Native libraries. Instructions to enable ",(0,a.kt)("em",{parentName:"p"},"autolinking")," are available in the ",(0,a.kt)("a",v({parentName:"p"},{href:"https://github.com/react-native-community/cli/blob/master/docs/autolinking.md"}),"React Native CLI docs"),"."),(0,a.kt)("h3",v({},{id:"android"}),"Android"),(0,a.kt)("p",null,"On Android, this generally requires you to include ",(0,a.kt)("inlineCode",{parentName:"p"},"native_modules.gradle")," in both your ",(0,a.kt)("inlineCode",{parentName:"p"},"settings.gradle")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"build.gradle"),"."),(0,a.kt)("p",null,"If you used the default template provided with React Native (i.e., ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn react-native init <Project>"),"), then autolinking is already enabled."),(0,a.kt)("p",null,"You can anyway verify that you have it enabled with:"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-bash"}),'$ grep -r "native_modules.gradle" android\n\nandroid/app/build.gradle:apply from: file("../../node_modules/@react-native-community/cli-platform-android/native_modules.gradle"); applyNativeModulesAppBuildGradle(project)\nandroid/settings.gradle:apply from: file("../node_modules/@react-native-community/cli-platform-android/native_modules.gradle"); applyNativeModulesSettingsGradle(settings)\n...\n')),(0,a.kt)("p",null,"If you don't, open the ",(0,a.kt)("inlineCode",{parentName:"p"},"settings.gradle")," file and add this line:"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-diff"}),'rootProject.name = <Your App Name>\n+ apply from: file("../node_modules/@react-native-community/cli-platform-android/native_modules.gradle"); applyNativeModulesSettingsGradle(settings)\n')),(0,a.kt)("p",null,"Then, open your ",(0,a.kt)("inlineCode",{parentName:"p"},"android/app/build.gradle")," file and add this line at the end of the file:"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-kotlin"}),'apply from: file("../../node_modules/@react-native-community/cli-platform-android/native_modules.gradle"); applyNativeModulesAppBuildGradle(project)\n')),(0,a.kt)("h3",v({},{id:"ios"}),"iOS"),(0,a.kt)("p",null,"On iOS, make sure that your library provides a Podspec (see ",(0,a.kt)("a",v({parentName:"p"},{href:"https://github.com/react-native-community/react-native-webview/blob/master/react-native-webview.podspec"}),(0,a.kt)("inlineCode",{parentName:"a"},"react-native-webview"))," for an example)."),(0,a.kt)("admonition",v({},{type:"info"}),(0,a.kt)("p",{parentName:"admonition"},"To determine if your library is set up for autolinking, check the CocoaPods output after running ",(0,a.kt)("inlineCode",{parentName:"p"},"pod install")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},"arch -x86_64 pod install"),' in case of a Mac M1) on an iOS project. If you see "auto linking library name", you are all set to go.')),(0,a.kt)("h2",v({},{id:"configure-codegen"}),"Configure Codegen"),(0,a.kt)("p",null,(0,a.kt)("a",v({parentName:"p"},{href:"the-new-architecture/pillars-codegen"}),"Codegen")," is a tool that runs when you build an Android app or install the dependencies of an iOS app. It creates some scaffolding code that you won't have to create manually."),(0,a.kt)("p",null,"Codegen can be configured in the ",(0,a.kt)("inlineCode",{parentName:"p"},"package.json")," file of your Library. Add the following JSON object at the end of it."),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-diff"}),'  },\n+  "codegenConfig": {\n+    "name": "<library name>",\n+    "type": "all",\n+    "jsSrcsDir": ".",\n+    "android": {\n+      "javaPackageName": "com.facebook.fbreact.specs"\n+    }\n+  }\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"codegenConfig")," is the key used by the Codegen to verify that there is some code to generate."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," field is the name of the library."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"type")," field is used to identify the type of module we want to create. We suggest keeping ",(0,a.kt)("inlineCode",{parentName:"li"},"all")," to support libraries that contain both Turbo Native Module and Fabric Native Components."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"jsSrcsDir")," is the directory where the codegen will start looking for JavaScript specs."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"android.javaPackageName")," is the name of the package where the generated code ends up.")),(0,a.kt)("p",null,"Android also requires to have the ",(0,a.kt)("a",v({parentName:"p"},{href:"new-architecture-app-intro#android-specifics"}),"React Gradle Plugin properly configured")," in your app."),(0,a.kt)("h2",v({},{id:"migrating-from-uimanager-javascript-apis"}),"Migrating from ",(0,a.kt)("inlineCode",{parentName:"h2"},"UIManager")," JavaScript APIs"),(0,a.kt)("p",null,"In the New Architecture, most ",(0,a.kt)("inlineCode",{parentName:"p"},"UIManager")," methods will become available as instance methods on native component instances obtained via ",(0,a.kt)("inlineCode",{parentName:"p"},"ref"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-ts"}),"function MyComponent(props: Props) {\n  const viewRef = useRef(null);\n\n  useEffect(() => {\n    viewRef.current.measure(((left, top, width, height, pageX, pageY) => {\n      // ...\n    });\n  }, []);\n\n  return <View ref={viewRef} />;\n}\n")),(0,a.kt)("p",null,"This new API design provides several benefits:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Better developer ergonomics by removing the need for separately importing ",(0,a.kt)("inlineCode",{parentName:"li"},"UIManager")," or calling ",(0,a.kt)("inlineCode",{parentName:"li"},"findNodeHandle"),"."),(0,a.kt)("li",{parentName:"ul"},"Better performance by avoiding the node handle lookup step."),(0,a.kt)("li",{parentName:"ul"},"Directionally aligned with ",(0,a.kt)("a",v({parentName:"li"},{href:"https://reactjs.org/docs/strict-mode.html#warning-about-deprecated-finddomnode-usage"}),"the analogous deprecation of ",(0,a.kt)("inlineCode",{parentName:"a"},"findDOMNode")),".")),(0,a.kt)("p",null,"We will eventually deprecate ",(0,a.kt)("inlineCode",{parentName:"p"},"UIManager"),". However, we recognize that migrations demand a high cost for many application and library authors. In order to minimize this cost, we plan to continue supporting as many of the methods on ",(0,a.kt)("inlineCode",{parentName:"p"},"UIManager")," as possible in the New Architecture."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Support for ",(0,a.kt)("inlineCode",{parentName:"strong"},"UIManager")," methods in the New Architecture is actively being developed.")," While we make progress here, early adopters can still experiment with the New Architecture by following these steps to migrate off common ",(0,a.kt)("inlineCode",{parentName:"p"},"UIManager")," APIs:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Migrating off ",(0,a.kt)("inlineCode",{parentName:"li"},"setNativeProps")),(0,a.kt)("li",{parentName:"ol"},"Move the call to ",(0,a.kt)("inlineCode",{parentName:"li"},"requireNativeComponent")," to a separate file"),(0,a.kt)("li",{parentName:"ol"},"Migrating off ",(0,a.kt)("inlineCode",{parentName:"li"},"dispatchViewManagerCommand")),(0,a.kt)("li",{parentName:"ol"},"Creating NativeCommands with ",(0,a.kt)("inlineCode",{parentName:"li"},"codegenNativeCommands"))),(0,a.kt)("h3",v({},{id:"migrating-off-setnativeprops"}),"Migrating off ",(0,a.kt)("inlineCode",{parentName:"h3"},"setNativeProps")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"setNativeProps")," will not be supported in the post-Fabric world. To migrate, move all ",(0,a.kt)("inlineCode",{parentName:"p"},"setNativeProp")," values to component state."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example")),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-ts"}),"class MyComponent extends React.Component<Props> {\n  _viewRef: ?React.ElementRef<typeof View>;\n\n  render() {\n    const {somePropValue} = this.props;\n    return <View\n       onPress={this._onSubmit}\n       ref={this._captureRef}\n       someProp={somePropValue}\n       style={styles.view} />\n  }\n\n  _captureRef: (ref: React.ElementRef<typeof View>) => {\n    this._viewRef = ref;\n  }\n\n  _onSubmit: () => {\n    this._viewRef.setNativeProps({\n       style: styles.submittedView,\n       accessibility: true\n    });\n    // ...other logic for onSubmit\n  }\n}\n\nconst styles = StyleSheet.create({\n  view: {backgroundColor: 'white'},\n  submittedView: {borderWidth: 1}\n});\n")),(0,a.kt)("p",null,"In this example, when the View is pressed, there is a ",(0,a.kt)("inlineCode",{parentName:"p"},"setNativeProps")," call to update the style and accessibility props of the component. To migrate this component, it\u2019s important to understand its current behavior using ",(0,a.kt)("inlineCode",{parentName:"p"},"setNativeProps"),"."),(0,a.kt)("h4",v({},{id:"pre-fabric-component-props-persist"}),"Pre-Fabric, Component Props Persist"),(0,a.kt)("p",null,"On the first render, the component props are those declared in the render function. After the View is pressed ",(0,a.kt)("inlineCode",{parentName:"p"},"_onSubmit")," calls ",(0,a.kt)("inlineCode",{parentName:"p"},"setNativeProps")," with updated prop values.\nThe resulting component can be represented as such:"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-tsx"}),"<View\n  accessibility={true}\n  onPress={this._onSubmit}\n  ref={this._captureRef}\n  someProp={somePropValue}\n  style={[styles.view, styles.submittedView]}\n/>\n")),(0,a.kt)("p",null,"Note that all prop values set in the render function are unchanged even though ",(0,a.kt)("inlineCode",{parentName:"p"},"setNativeProps")," didn\u2019t pass those props. Also, ",(0,a.kt)("inlineCode",{parentName:"p"},"style")," is now the merged value of its value prior to ",(0,a.kt)("inlineCode",{parentName:"p"},"_onSubmit")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"styles.submittedView"),". This is the important takeaway: in our current pre-Fabric world, ",(0,a.kt)("strong",{parentName:"p"},"component props persist.")," The platform view caches the prop values it's passed from the JS side. If this wasn\u2019t the case, then following the setNativeProps call, React Native would have rendered a component like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-tsx"}),"<View accessibility={true} style={styles.submittedView} />\n")),(0,a.kt)("p",null,"The fact that React Native stores some internal state of each component that isn\u2019t explicitly declared in the last render is what Fabric intends to fix."),(0,a.kt)("h4",v({},{id:"moving-setnativeprops-to-state"}),"Moving ",(0,a.kt)("inlineCode",{parentName:"h4"},"setNativeProps")," to state"),(0,a.kt)("p",null,"Taking the above caveats into account, a proper migration would look like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-tsx"}),"class MyComponent extends React.Component<Props> {\n  state = {\n    hasSubmitted: false,\n    accessibility: false\n  };\n\n  render() {\n    const {somePropValue} = this.props;\n    const submittedStyle = this.state.hasSubmitted ? styles.submittedView: null;\n    return <View\n       accessibility={this.state.accessibility}\n       onPress={this._onSubmit}\n       someProp={somePropValue}\n       style={[styles.view, submittedStyle]} />\n  }\n\n  _onSubmit: () => {\n    this.setState(state => ({...state, hasSubmitted: true}));\n    // ...other logic for onSubmit\n  }\n}\n\n\nconst styles = StyleSheet.create({\n  view: {backgroundColor: 'white'},\n  submittedView: {borderWidth: 1}\n});\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"We are using the ",(0,a.kt)("inlineCode",{parentName:"li"},"hasSubmitted")," flag to represent whether or not we want to apply ",(0,a.kt)("inlineCode",{parentName:"li"},"styles.submittedView"),". If the style was dynamic, then it makes sense to store the style object in state."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"accessibility")," is now explicitly passed to the View component as a boolean. This differs from the prior implementation where ",(0,a.kt)("inlineCode",{parentName:"li"},"accessibility")," wasn\u2019t passed as a prop in the initial render, but in this case, we know the non-specification of ",(0,a.kt)("inlineCode",{parentName:"li"},"accessibility")," is handled in the same way as ",(0,a.kt)("inlineCode",{parentName:"li"},"accessibilty={false}"),".")),(0,a.kt)("p",null,"Be wary of your assumptions, as uncaught subtleties can introduce differences in behavior! It\u2019s a good idea to have snapshot tests of your component as they will highlight any differences pre and post your migration."),(0,a.kt)("h3",v({},{id:"move-the-call-to-requirenativecomponent-to-a-separate-file"}),"Move the call to ",(0,a.kt)("inlineCode",{parentName:"h3"},"requireNativeComponent")," to a separate file"),(0,a.kt)("p",null,"This will prepare for the JS to be ready for the new codegen system for the New Architecture. The new file should be named ",(0,a.kt)("inlineCode",{parentName:"p"},"<ComponentName>NativeComponent.js.")),(0,a.kt)("h4",v({},{id:"old-way"}),"Old way"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-js"}),"const RNTMyNativeView = requireNativeComponent('RNTMyNativeView');\n\n[...]\n\nreturn <RNTMyNativeView />;\n")),(0,a.kt)("h4",v({},{id:"new-way"}),"New way"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-tsx",metastring:'title="RNTMyNativeNativeComponent.tsx"',title:'"RNTMyNativeNativeComponent.tsx"'}),"import RNTMyNativeViewNativeComponent from './RNTMyNativeViewNativeComponent';\n\n[...]\n\nreturn <RNTMyNativeViewNativeComponent />;\n")),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-tsx",metastring:'title="RNTMyNativeViewNativeComponent.tsx"',title:'"RNTMyNativeViewNativeComponent.tsx"'}),"import {requireNativeComponent} from 'react-native';\n\nconst RNTMyNativeViewNativeComponent = requireNativeComponent(\n  'RNTMyNativeView',\n);\n\nexport default RNTMyNativeViewNativeComponent;\n")),(0,a.kt)("h4",v({},{id:"flow-support"}),"Flow support"),(0,a.kt)("p",null,"If ",(0,a.kt)("inlineCode",{parentName:"p"},"requireNativeComponent")," is not typed, you can temporarily use the ",(0,a.kt)("inlineCode",{parentName:"p"},"mixed")," type to fix the Flow warning, for example:"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-js"}),"import type {HostComponent} from 'react-native/Libraries/Renderer/shims/ReactNativeTypes';\n// ...\nconst RCTWebViewNativeComponent: HostComponent<mixed> =\n  requireNativeComponent < mixed > 'RNTMyNativeView';\n")),(0,a.kt)("h4",v({},{id:"later-on-you-can-replace-requirenativecomponent"}),"Later on you can replace ",(0,a.kt)("inlineCode",{parentName:"h4"},"requireNativeComponent")),(0,a.kt)("p",null,"When you are ready to migrate to Fabric you can replace ",(0,a.kt)("inlineCode",{parentName:"p"},"requireNativeComponent")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"codegenNativeComponent"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-ts",metastring:'title="RNTMyNativeViewNativeComponent.ts"',title:'"RNTMyNativeViewNativeComponent.ts"'}),"export default (codegenNativeComponent<NativeProps>(\n   'RNTMyNativeView',\n): HostComponent<NativeProps>);\n")),(0,a.kt)("p",null,"And update the main file:"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-ts",metastring:'title="RNTMyNativeNativeComponent.ts"',title:'"RNTMyNativeNativeComponent.ts"'}),"export default require('./RNTMyNativeViewNativeComponent')\n  .default;\n")),(0,a.kt)("h3",v({},{id:"migrating-off-dispatchviewmanagercommand"}),"Migrating off ",(0,a.kt)("inlineCode",{parentName:"h3"},"dispatchViewManagerCommand")),(0,a.kt)("p",null,"Similar to the one above, in an effort to avoid calling methods on the UIManager, all view manager methods are now called through an instance of ",(0,a.kt)("inlineCode",{parentName:"p"},"NativeCommands"),". ",(0,a.kt)("inlineCode",{parentName:"p"},"codegenNativeCommands")," is a new API to code-generate ",(0,a.kt)("inlineCode",{parentName:"p"},"NativeCommands")," given an interface of your view manager\u2019s commands."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Before")),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-tsx"}),"class MyComponent extends React.Component<Props> {\n  _moveToRegion: (region: Region, duration: number) => {\n    UIManager.dispatchViewManagerCommand(\n      ReactNative.findNodeHandle(this),\n      'moveToRegion',\n      [region, duration]\n    );\n  }\n\n  render() {\n    return <MyCustomMapNativeComponent onPress={this._moveToRegion} />\n  }\n}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Creating NativeCommands with ",(0,a.kt)("inlineCode",{parentName:"strong"},"codegenNativeCommands"))),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-ts",metastring:'title="MyCustomMapNativeComponent.ts"',title:'"MyCustomMapNativeComponent.ts"'}),"import codegenNativeCommands from 'react-native/Libraries/Utilities/codegenNativeCommands';\nimport type {HostComponent} from 'react-native/Libraries/Renderer/shims/ReactNativeTypes';\n\ntype MyCustomMapNativeComponentType = HostComponent<NativeProps>;\n\ninterface NativeCommands {\n  +moveToRegion: (\n     viewRef: React.ElementRef<MyCustomMapNativeComponentType>,\n      region: MapRegion,\n      duration: number,\n   ) => void;\n }\n\nexport const Commands: NativeCommands = codegenNativeCommands<NativeCommands>({\n  supportedCommands: ['moveToRegion'],\n});\n")),(0,a.kt)("p",null,"Note:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The first argument in the ",(0,a.kt)("inlineCode",{parentName:"li"},"moveToRegion")," command is a HostComponent ref of the native component"),(0,a.kt)("li",{parentName:"ul"},"The arguments to the ",(0,a.kt)("inlineCode",{parentName:"li"},"moveToRegion")," command are enumerated in the signature"),(0,a.kt)("li",{parentName:"ul"},"The command definition is co-located with the native component. This is an encouraged pattern"),(0,a.kt)("li",{parentName:"ul"},"Ensure you have included your command name in the ",(0,a.kt)("inlineCode",{parentName:"li"},"supportedCommands")," array")),(0,a.kt)("h4",v({},{id:"using-your-command"}),"Using Your Command"),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-tsx"}),"import {Commands, ...} from './MyCustomMapNativeComponent';\n\nclass MyComponent extends React.Component<Props> {\n  _ref?: React.ElementRef<typeof MyCustomMapNativeComponent>;\n\n  _captureRef: (ref: React.ElementRef<typeof MyCustomMapNativeComponent>) => {\n    this._ref = ref;\n  }\n\n  _moveToRegion: (region: Region, duration: number) => {\n    if (this._ref != null) {\n      Commands.moveToRegion(this._ref, region, duration);\n    }\n  }\n\n  render() {\n    return <MyCustomMapNativeComponent\n       ref={this._captureRef}\n       onPress={this._moveToRegion} />\n  }\n}\n")),(0,a.kt)("h4",v({},{id:"updating-native-implementation"}),"Updating Native Implementation"),(0,a.kt)("p",null,"In the example, the code-generated ",(0,a.kt)("inlineCode",{parentName:"p"},"Commands")," will dispatch ",(0,a.kt)("inlineCode",{parentName:"p"},"moveToRegion")," call to the native component\u2019s view manager. In addition to writing the JS interface, you\u2019ll need to update your native implementation signatures to match the dispatched method call. See the mapping for ",(0,a.kt)("a",v({parentName:"p"},{href:"https://facebook.github.io/react-native/docs/native-modules-android#argument-types"}),"Android argument types")," and",(0,a.kt)("a",v({parentName:"p"},{href:"https://facebook.github.io/react-native/docs/native-modules-ios#argument-types"}),"iOS argument types")," for reference."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"iOS")),(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-objc"}),"RCT_EXPORT_METHOD(moveToRegion:(nonnull NSNumber *)reactTag\n                        region:(NSDictionary *)region\n                      duration:(double)duration\n{\n   ...\n}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Android")),(0,a.kt)(o.Z,{groupId:"android-language",defaultValue:i.Z.defaultAndroidLanguage,values:i.Z.androidLanguages,mdxType:"Tabs"},(0,a.kt)(r.Z,{value:"kotlin",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-kotlin"}),'    fun receiveCommand(\n        view: ReactMapDrawerView?, commandId: String?, args: ReadableArray?\n    ) {\n        when (commandId) {\n            "moveToRegion" -> {\n                if (args != null) {\n                    val region: ReadableMap = args.getMap(0)\n                    val durationMs: Int = args.getInt(1)\n                    // ... act on the view...\n                }\n            }\n        }\n    }\n'))),(0,a.kt)(r.Z,{value:"java",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",v({parentName:"pre"},{className:"language-java"}),'// receiveCommand signature has changed to receive String commandId\n@Override\n  public void receiveCommand(\n      ReactMapDrawerView view, String commandId, @Nullable ReadableArray args) {\n    switch (commandId) {\n      case "moveToRegion":\n        if (args == null) {\n          break;\n        }\n\n        ReadableMap region = args.getMap(0);\n        int durationMs = args.getInt(1);\n        // ... act on the view...\n        break;\n    }\n  }\n')))))}w.isMDXComponent=!0}}]);