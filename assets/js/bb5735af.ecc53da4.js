"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[865],{35318:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return d}});var n=a(27378);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),s=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=s(e.components);return n.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=s(a),d=r,v=m["".concat(c,".").concat(d)]||m[d]||u[d]||i;return a?n.createElement(v,o(o({ref:t},p),{},{components:a})):n.createElement(v,o({ref:t},p))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},10342:function(e,t,a){a.r(t),a.d(t,{assets:function(){return k},contentTitle:function(){return d},default:function(){return N},frontMatter:function(){return m},metadata:function(){return v},toc:function(){return g}});var n=a(35318),r=Object.defineProperty,i=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,p=(e,t,a)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,u=(e,t)=>{for(var a in t||(t={}))c.call(t,a)&&p(e,a,t[a]);if(l)for(var a of l(t))s.call(t,a)&&p(e,a,t[a]);return e};const m={id:"native-modules-android",title:"Android \u539f\u751f\u6a21\u5757"},d=void 0,v={unversionedId:"native-modules-android",id:"version-0.69/native-modules-android",title:"Android \u539f\u751f\u6a21\u5757",description:"\u6709\u65f6\u5019 App \u9700\u8981\u8bbf\u95ee\u5e73\u53f0 API\uff0c\u4f46 React Native \u53ef\u80fd\u8fd8\u6ca1\u6709\u76f8\u5e94\u7684\u6a21\u5757\u5305\u88c5\uff1b\u6216\u8005\u4f60\u9700\u8981\u590d\u7528\u4e00\u4e9b Java \u4ee3\u7801\uff0c\u800c\u4e0d\u662f\u7528 Javascript \u91cd\u65b0\u5b9e\u73b0\u4e00\u904d\uff1b\u53c8\u6216\u8005\u4f60\u9700\u8981\u5b9e\u73b0\u67d0\u4e9b\u9ad8\u6027\u80fd\u7684\u3001\u591a\u7ebf\u7a0b\u7684\u4ee3\u7801\uff0c\u8b6c\u5982\u56fe\u7247\u5904\u7406\u3001\u6570\u636e\u5e93\u3001\u6216\u8005\u5404\u79cd\u9ad8\u7ea7\u6269\u5c55\u7b49\u7b49\u3002",source:"@site/versioned_docs/version-0.69/native-modules-android.md",sourceDirName:".",slug:"/native-modules-android",permalink:"/docs/native-modules-android",draft:!1,editUrl:"https://github.com/facebook/react-native-website/blob/master/website/../cndocs/native-modules-android.md",tags:[],version:"0.69",frontMatter:{id:"native-modules-android",title:"Android \u539f\u751f\u6a21\u5757"},sidebar:"docs",previous:{title:"\u539f\u751f\u6a21\u5757\u7b80\u4ecb",permalink:"/docs/native-modules-intro"},next:{title:"iOS \u539f\u751f\u6a21\u5757",permalink:"/docs/native-modules-ios"}},k={},g=[{value:"Native Module Setup",id:"native-module-setup",level:2},{value:"\u5f00\u542f Gradle Daemon",id:"\u5f00\u542f-gradle-daemon",level:3},{value:"Toast \u6a21\u5757",id:"toast-\u6a21\u5757",level:2},{value:"\u53c2\u6570\u7c7b\u578b",id:"\u53c2\u6570\u7c7b\u578b",level:3},{value:"\u6ce8\u518c\u6a21\u5757",id:"\u6ce8\u518c\u6a21\u5757",level:3},{value:"\u66f4\u591a\u7279\u6027",id:"\u66f4\u591a\u7279\u6027",level:2},{value:"\u56de\u8c03\u51fd\u6570",id:"\u56de\u8c03\u51fd\u6570",level:3},{value:"Promises",id:"promises",level:3},{value:"\u591a\u7ebf\u7a0b",id:"\u591a\u7ebf\u7a0b",level:3},{value:"\u53d1\u9001\u4e8b\u4ef6\u5230 JavaScript",id:"\u53d1\u9001\u4e8b\u4ef6\u5230-javascript",level:3},{value:"\u4ece<code>startActivityForResult</code>\u4e2d\u83b7\u53d6\u7ed3\u679c",id:"\u4ecestartactivityforresult\u4e2d\u83b7\u53d6\u7ed3\u679c",level:3},{value:"\u76d1\u542c\u751f\u547d\u5468\u671f\u4e8b\u4ef6",id:"\u76d1\u542c\u751f\u547d\u5468\u671f\u4e8b\u4ef6",level:3}],f={toc:g};function N(e){var t,a=e,{components:r}=a,p=((e,t)=>{var a={};for(var n in e)c.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&l)for(var n of l(e))t.indexOf(n)<0&&s.call(e,n)&&(a[n]=e[n]);return a})(a,["components"]);return(0,n.kt)("wrapper",(t=u(u({},f),p),i(t,o({components:r,mdxType:"MDXLayout"}))),(0,n.kt)("p",null,"\u6709\u65f6\u5019 App \u9700\u8981\u8bbf\u95ee\u5e73\u53f0 API\uff0c\u4f46 React Native \u53ef\u80fd\u8fd8\u6ca1\u6709\u76f8\u5e94\u7684\u6a21\u5757\u5305\u88c5\uff1b\u6216\u8005\u4f60\u9700\u8981\u590d\u7528\u4e00\u4e9b Java \u4ee3\u7801\uff0c\u800c\u4e0d\u662f\u7528 Javascript \u91cd\u65b0\u5b9e\u73b0\u4e00\u904d\uff1b\u53c8\u6216\u8005\u4f60\u9700\u8981\u5b9e\u73b0\u67d0\u4e9b\u9ad8\u6027\u80fd\u7684\u3001\u591a\u7ebf\u7a0b\u7684\u4ee3\u7801\uff0c\u8b6c\u5982\u56fe\u7247\u5904\u7406\u3001\u6570\u636e\u5e93\u3001\u6216\u8005\u5404\u79cd\u9ad8\u7ea7\u6269\u5c55\u7b49\u7b49\u3002"),(0,n.kt)("p",null,"\u6211\u4eec\u628a React Native \u8bbe\u8ba1\u4e3a\u53ef\u4ee5\u5728\u5176\u57fa\u7840\u4e0a\u7f16\u5199\u771f\u6b63\u7684\u539f\u751f\u4ee3\u7801\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bbf\u95ee\u5e73\u53f0\u6240\u6709\u7684\u80fd\u529b\u3002\u8fd9\u662f\u4e00\u4e2a\u76f8\u5bf9\u9ad8\u7ea7\u7684\u7279\u6027\uff0c\u6211\u4eec\u5e76\u4e0d\u8ba4\u4e3a\u5b83\u5e94\u5f53\u5728\u65e5\u5e38\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\u7ecf\u5e38\u51fa\u73b0\uff0c\u4f46\u5177\u5907\u8fd9\u6837\u7684\u80fd\u529b\u662f\u5f88\u91cd\u8981\u7684\u3002\u5982\u679c React Native \u8fd8\u4e0d\u652f\u6301\u67d0\u4e2a\u4f60\u9700\u8981\u7684\u539f\u751f\u7279\u6027\uff0c\u4f60\u5e94\u5f53\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u8be5\u7279\u6027\u7684\u5c01\u88c5\u3002"),(0,n.kt)("h2",u({},{id:"native-module-setup"}),"Native Module Setup"),(0,n.kt)("p",null,"Native modules are usually distributed as npm packages, apart from the typical javascript files and resources they will contain an Android library project. This project is, from NPM's perspective just like any other media asset, meaning there isn't anything special about it from this point of view. To get the basic scaffolding make sure to read ",(0,n.kt)("a",u({parentName:"p"},{href:"native-modules-setup"}),"Native Modules Setup")," guide first."),(0,n.kt)("h3",u({},{id:"\u5f00\u542f-gradle-daemon"}),"\u5f00\u542f Gradle Daemon"),(0,n.kt)("p",null,"\u6211\u4eec\u5efa\u8bae\u5f00\u542f",(0,n.kt)("a",u({parentName:"p"},{href:"https://docs.gradle.org/2.9/userguide/gradle_daemon.html"}),"Gradle Daemon"),"\u6765\u52a0\u901f Java \u4ee3\u7801\u7f16\u8bd1\u3002"),(0,n.kt)("h2",u({},{id:"toast-\u6a21\u5757"}),"Toast \u6a21\u5757"),(0,n.kt)("p",null,"\u672c\u5411\u5bfc\u4f1a\u7528",(0,n.kt)("a",u({parentName:"p"},{href:"http://developer.android.com/reference/android/widget/Toast.html"}),"Toast"),"\u4f5c\u4e3a\u4f8b\u5b50\u3002\u5047\u8bbe\u6211\u4eec\u5e0c\u671b\u53ef\u4ee5\u4ece Javascript \u53d1\u8d77\u4e00\u4e2a Toast \u6d88\u606f\uff08\u4e00\u79cd\u4f1a\u5728\u5c4f\u5e55\u4e0b\u65b9\u5f39\u51fa\u3001\u4fdd\u6301\u4e00\u6bb5\u65f6\u95f4\u7684\u6d88\u606f\u901a\u77e5\uff09\u3002"),(0,n.kt)("p",null,"\u6211\u4eec\u9996\u5148\u6765\u521b\u5efa\u4e00\u4e2a\u539f\u751f\u6a21\u5757\u3002\u4e00\u4e2a\u539f\u751f\u6a21\u5757\u662f\u4e00\u4e2a\u7ee7\u627f\u4e86",(0,n.kt)("inlineCode",{parentName:"p"},"ReactContextBaseJavaModule"),"\u7684 Java \u7c7b\uff0c\u5b83\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e9b JavaScript \u6240\u9700\u7684\u529f\u80fd\u3002\u6211\u4eec\u8fd9\u91cc\u7684\u76ee\u6807\u662f\u53ef\u4ee5\u5728 JavaScript \u91cc\u5199",(0,n.kt)("inlineCode",{parentName:"p"},"ToastExample.show('Awesome', ToastExample.SHORT);"),"\uff0c\u6765\u8c03\u8d77\u4e00\u4e2a\u77ed\u6682\u7684 Toast \u901a\u77e5\u3002"),(0,n.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Java \u7c7b\u5e76\u547d\u540d\u4e3a",(0,n.kt)("inlineCode",{parentName:"p"},"ToastModule.java"),"\uff0c\u653e\u7f6e\u5230",(0,n.kt)("inlineCode",{parentName:"p"},"android/app/src/main/java/com/your-app-name/"),"\u76ee\u5f55\u4e0b\uff0c\u5176\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'// ToastModule.java\n\npackage com.your-app-name;\n\nimport android.widget.Toast;\n\nimport com.facebook.react.bridge.NativeModule;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.bridge.ReactContext;\nimport com.facebook.react.bridge.ReactContextBaseJavaModule;\nimport com.facebook.react.bridge.ReactMethod;\n\nimport java.util.Map;\nimport java.util.HashMap;\n\npublic class ToastModule extends ReactContextBaseJavaModule {\n  private static ReactApplicationContext reactContext;\n\n  private static final String DURATION_SHORT_KEY = "SHORT";\n  private static final String DURATION_LONG_KEY = "LONG";\n\n  public ToastModule(ReactApplicationContext context) {\n    super(context);\n    reactContext = context;\n  }\n}\n')),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"ReactContextBaseJavaModule"),"\u8981\u6c42\u6d3e\u751f\u7c7b\u5b9e\u73b0",(0,n.kt)("inlineCode",{parentName:"p"},"getName"),"\u65b9\u6cd5\u3002\u8fd9\u4e2a\u51fd\u6570\u7528\u4e8e\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u540d\u5b57\uff0c\u8fd9\u4e2a\u540d\u5b57\u5728 JavaScript \u7aef\u6807\u8bb0\u8fd9\u4e2a\u6a21\u5757\u3002\u8fd9\u91cc\u6211\u4eec\u628a\u8fd9\u4e2a\u6a21\u5757\u53eb\u505a",(0,n.kt)("inlineCode",{parentName:"p"},"ToastExample"),"\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728 JavaScript \u4e2d\u901a\u8fc7",(0,n.kt)("inlineCode",{parentName:"p"},"NativeModules.ToastExample"),"\u8bbf\u95ee\u5230\u8fd9\u4e2a\u6a21\u5757\u3002",(0,n.kt)("strong",{parentName:"p"},"\u8bd1\u6ce8\uff1aRN \u5df2\u7ecf\u5185\u7f6e\u4e86\u4e00\u4e2a\u540d\u4e3a ToastAndroid \u7684\u6a21\u5757\uff0c\u6240\u4ee5\u5728\u7ec3\u4e60\u65f6\u8bf7\u52ff\u4f7f\u7528 ToastAndroid \u7684\u540d\u5b57\uff0c\u5426\u5219\u8fd0\u884c\u65f6\u4f1a\u62a5\u9519\u540d\u5b57\u51b2\u7a81\uff01")),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'  @Override\n  public String getName() {\n    return "ToastExample";\n  }\n')),(0,n.kt)("p",null,"\u4e00\u4e2a\u53ef\u9009\u7684\u65b9\u6cd5",(0,n.kt)("inlineCode",{parentName:"p"},"getContants"),"\u8fd4\u56de\u4e86\u9700\u8981\u5bfc\u51fa\u7ed9 JavaScript \u4f7f\u7528\u7684\u5e38\u91cf\u3002\u5b83\u5e76\u4e0d\u4e00\u5b9a\u9700\u8981\u5b9e\u73b0\uff0c\u4f46\u5728\u5b9a\u4e49\u4e00\u4e9b\u53ef\u4ee5\u88ab JavaScript \u540c\u6b65\u8bbf\u95ee\u5230\u7684\u9884\u5b9a\u4e49\u7684\u503c\u65f6\u975e\u5e38\u6709\u7528\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"  @Override\n  public Map<String, Object> getConstants() {\n    final Map<String, Object> constants = new HashMap<>();\n    constants.put(DURATION_SHORT_KEY, Toast.LENGTH_SHORT);\n    constants.put(DURATION_LONG_KEY, Toast.LENGTH_LONG);\n    return constants;\n  }\n")),(0,n.kt)("p",null,"\u8981\u5bfc\u51fa\u4e00\u4e2a\u65b9\u6cd5\u7ed9 JavaScript \u4f7f\u7528\uff0cJava \u65b9\u6cd5\u9700\u8981\u4f7f\u7528\u6ce8\u89e3",(0,n.kt)("inlineCode",{parentName:"p"},"@ReactMethod"),"\u3002\u65b9\u6cd5\u7684\u8fd4\u56de\u7c7b\u578b\u5fc5\u987b\u4e3a",(0,n.kt)("inlineCode",{parentName:"p"},"void"),"\u3002React Native \u7684\u8de8\u8bed\u8a00\u8bbf\u95ee\u662f\u5f02\u6b65\u8fdb\u884c\u7684\uff0c\u6240\u4ee5\u60f3\u8981\u7ed9 JavaScript \u8fd4\u56de\u4e00\u4e2a\u503c\u7684\u552f\u4e00\u529e\u6cd5\u662f\u4f7f\u7528\u56de\u8c03\u51fd\u6570\u6216\u8005\u53d1\u9001\u4e8b\u4ef6\uff08\u53c2\u89c1\u4e0b\u6587\u7684\u63cf\u8ff0\uff09\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"  @ReactMethod\n  public void show(String message, int duration) {\n    Toast.makeText(getReactApplicationContext(), message, duration).show();\n  }\n")),(0,n.kt)("h3",u({},{id:"\u53c2\u6570\u7c7b\u578b"}),"\u53c2\u6570\u7c7b\u578b"),(0,n.kt)("p",null,"\u4e0b\u9762\u7684\u53c2\u6570\u7c7b\u578b\u5728",(0,n.kt)("inlineCode",{parentName:"p"},"@ReactMethod"),"\u6ce8\u660e\u7684\u65b9\u6cd5\u4e2d\uff0c\u4f1a\u88ab\u76f4\u63a5\u6620\u5c04\u5230\u5b83\u4eec\u5bf9\u5e94\u7684 JavaScript \u7c7b\u578b\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-text"}),"Boolean -> Bool\nInteger -> Number\nDouble -> Number\nFloat -> Number\nString -> String\nCallback -> function\nReadableMap -> Object\nReadableArray -> Array\n")),(0,n.kt)("p",null,"\u53c2\u9605",(0,n.kt)("a",u({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/master/ReactAndroid/src/main/java/com/facebook/react/bridge/ReadableMap.java"}),"ReadableMap"),"\u548c",(0,n.kt)("a",u({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/master/ReactAndroid/src/main/java/com/facebook/react/bridge/ReadableArray.java"}),"ReadableArray"),"\u3002"),(0,n.kt)("h3",u({},{id:"\u6ce8\u518c\u6a21\u5757"}),"\u6ce8\u518c\u6a21\u5757"),(0,n.kt)("p",null,"\u5728 Java \u8fd9\u8fb9\u8981\u505a\u7684\u6700\u540e\u4e00\u4ef6\u4e8b\u5c31\u662f\u6ce8\u518c\u8fd9\u4e2a\u6a21\u5757\u3002\u6211\u4eec\u9700\u8981\u5728\u5e94\u7528\u7684 Package \u7c7b\u7684",(0,n.kt)("inlineCode",{parentName:"p"},"createNativeModules"),"\u65b9\u6cd5\u4e2d\u6dfb\u52a0\u8fd9\u4e2a\u6a21\u5757\u3002\u5982\u679c\u6a21\u5757\u6ca1\u6709\u88ab\u6ce8\u518c\uff0c\u5b83\u4e5f\u65e0\u6cd5\u5728 JavaScript \u4e2d\u88ab\u8bbf\u95ee\u5230\u3002"),(0,n.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Java \u7c7b\u5e76\u547d\u540d\u4e3a",(0,n.kt)("inlineCode",{parentName:"p"},"CustomToastPackage.java"),"\uff0c\u653e\u7f6e\u5230",(0,n.kt)("inlineCode",{parentName:"p"},"android/app/src/main/java/com/your-app-name/"),"\u76ee\u5f55\u4e0b\uff0c\u5176\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"// CustomToastPackage.java\n\npackage com.your-app-name;\n\nimport com.facebook.react.ReactPackage;\nimport com.facebook.react.bridge.NativeModule;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.uimanager.ViewManager;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\n\npublic class CustomToastPackage implements ReactPackage {\n\n  @Override\n  public List<ViewManager> createViewManagers(ReactApplicationContext reactContext) {\n    return Collections.emptyList();\n  }\n\n  @Override\n  public List<NativeModule> createNativeModules(\n                              ReactApplicationContext reactContext) {\n    List<NativeModule> modules = new ArrayList<>();\n\n    modules.add(new ToastModule(reactContext));\n\n    return modules;\n  }\n\n}\n")),(0,n.kt)("p",null,"\u8fd9\u4e2a package \u9700\u8981\u5728",(0,n.kt)("inlineCode",{parentName:"p"},"MainApplication.java"),"\u6587\u4ef6\u7684",(0,n.kt)("inlineCode",{parentName:"p"},"getPackages"),"\u65b9\u6cd5\u4e2d\u63d0\u4f9b\u3002\u8fd9\u4e2a\u6587\u4ef6\u4f4d\u4e8e\u4f60\u7684 react-native \u5e94\u7528\u6587\u4ef6\u5939\u7684 android \u76ee\u5f55\u4e2d\u3002\u5177\u4f53\u8def\u5f84\u662f: ",(0,n.kt)("inlineCode",{parentName:"p"},"android/app/src/main/java/com/your-app-name/MainApplication.java"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'// MainApplication.java\n...\nimport com.your-app-name.CustomToastPackage; // <-- \u5f15\u5165\u4f60\u81ea\u5df1\u7684\u5305\n...\nprotected List<ReactPackage> getPackages() {\n  @SuppressWarnings("UnnecessaryLocalVariable")\n  List<ReactPackage> packages = new PackageList(this).getPackages();\n  // Packages that cannot be autolinked yet can be added manually here, for example:\n  // packages.add(new MyReactNativePackage());\n  packages.add(new CustomToastPackage()); // <-- \u6dfb\u52a0\u8fd9\u4e00\u884c\uff0c\u7c7b\u540d\u66ff\u6362\u6210\u4f60\u7684Package\u7c7b\u7684\u540d\u5b57 name.\n  return packages;\n}\n')),(0,n.kt)("p",null,"\u4e3a\u4e86\u8ba9\u4f60\u7684\u529f\u80fd\u4ece JavaScript \u7aef\u8bbf\u95ee\u8d77\u6765\u66f4\u4e3a\u65b9\u4fbf\uff0c\u901a\u5e38\u6211\u4eec\u90fd\u4f1a\u628a\u539f\u751f\u6a21\u5757\u5c01\u88c5\u6210\u4e00\u4e2a JavaScript \u6a21\u5757\u3002\u8fd9\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u4f46\u7701\u4e0b\u4e86\u6bcf\u6b21\u90fd\u4ece",(0,n.kt)("inlineCode",{parentName:"p"},"NativeModules"),"\u4e2d\u83b7\u53d6\u5bf9\u5e94\u6a21\u5757\u7684\u6b65\u9aa4\u3002\u8fd9\u4e2a JS \u6587\u4ef6\u4e5f\u53ef\u4ee5\u7528\u4e8e\u6dfb\u52a0\u4e00\u4e9b\u5176\u4ed6 JavaScript \u7aef\u5b9e\u73b0\u7684\u529f\u80fd\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"// ToastExample.js\n/**\n * This exposes the native ToastExample module as a JS module. This has a\n * function 'show' which takes the following parameters:\n *\n * 1. String message: A string with the text to toast\n * 2. int duration: The duration of the toast. May be ToastExample.SHORT or\n *    ToastExample.LONG\n */\nimport { NativeModules } from 'react-native';\n// \u4e0b\u4e00\u53e5\u4e2d\u7684ToastExample\u5373\u5bf9\u5e94\u4e0a\u6587\n// public String getName()\u4e2d\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\nexport default NativeModules.ToastExample;\n")),(0,n.kt)("p",null,"\u73b0\u5728\uff0c\u5728\u522b\u5904\u7684 JavaScript \u4ee3\u7801\u4e2d\u53ef\u4ee5\u8fd9\u6837\u8c03\u7528\u4f60\u7684\u65b9\u6cd5\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"import ToastExample from './ToastExample';\n\nToastExample.show('Awesome', ToastExample.SHORT);\n")),(0,n.kt)("h2",u({},{id:"\u66f4\u591a\u7279\u6027"}),"\u66f4\u591a\u7279\u6027"),(0,n.kt)("h3",u({},{id:"\u56de\u8c03\u51fd\u6570"}),"\u56de\u8c03\u51fd\u6570"),(0,n.kt)("p",null,"\u539f\u751f\u6a21\u5757\u8fd8\u652f\u6301\u4e00\u79cd\u7279\u6b8a\u7684\u53c2\u6570\u2014\u2014\u56de\u8c03\u51fd\u6570\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u51fd\u6570\u6765\u628a\u8fd4\u56de\u503c\u4f20\u56de\u7ed9 JavaScript\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"import com.facebook.react.bridge.Callback;\n\npublic class UIManagerModule extends ReactContextBaseJavaModule {\n\n...\n\n  @ReactMethod\n  public void measureLayout(\n      int tag,\n      int ancestorTag,\n      Callback errorCallback,\n      Callback successCallback) {\n    try {\n      measureLayout(tag, ancestorTag, mMeasureBuffer);\n      float relativeX = PixelUtil.toDIPFromPixel(mMeasureBuffer[0]);\n      float relativeY = PixelUtil.toDIPFromPixel(mMeasureBuffer[1]);\n      float width = PixelUtil.toDIPFromPixel(mMeasureBuffer[2]);\n      float height = PixelUtil.toDIPFromPixel(mMeasureBuffer[3]);\n      successCallback.invoke(relativeX, relativeY, width, height);\n    } catch (IllegalViewOperationException e) {\n      errorCallback.invoke(e.getMessage());\n    }\n  }\n\n...\n")),(0,n.kt)("p",null,"\u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u5728 JavaScript \u91cc\u8fd9\u6837\u4f7f\u7528\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"UIManager.measureLayout(\n  100,\n  100,\n  (msg) => {\n    console.log(msg);\n  },\n  (x, y, width, height) => {\n    console.log(x + ':' + y + ':' + width + ':' + height);\n  }\n);\n")),(0,n.kt)("p",null,"\u539f\u751f\u6a21\u5757\u901a\u5e38\u53ea\u5e94\u8c03\u7528\u56de\u8c03\u51fd\u6570\u4e00\u6b21\u3002\u4f46\u662f\uff0c\u5b83\u53ef\u4ee5\u4fdd\u5b58 callback \u5e76\u5728\u5c06\u6765\u8c03\u7528\u3002"),(0,n.kt)("p",null,"\u8bf7\u52a1\u5fc5\u6ce8\u610f callback \u5e76\u975e\u5728\u5bf9\u5e94\u7684\u539f\u751f\u51fd\u6570\u8fd4\u56de\u540e\u7acb\u5373\u88ab\u6267\u884c\u2014\u2014\u6ce8\u610f\u8de8\u8bed\u8a00\u901a\u8baf\u662f\u5f02\u6b65\u7684\uff0c\u8fd9\u4e2a\u6267\u884c\u8fc7\u7a0b\u4f1a\u901a\u8fc7\u6d88\u606f\u5faa\u73af\u6765\u8fdb\u884c\u3002"),(0,n.kt)("h3",u({},{id:"promises"}),"Promises"),(0,n.kt)("p",null,"Promises"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8bd1\u6ce8"),"\uff1a\u8fd9\u4e00\u90e8\u5206\u6d89\u53ca\u5230\u8f83\u65b0\u7684 js \u8bed\u6cd5\u548c\u7279\u6027\uff0c\u4e0d\u719f\u6089\u7684\u8bfb\u8005\u5efa\u8bae\u5148\u9605\u8bfb ES6 \u7684\u76f8\u5173\u4e66\u7c4d\u548c\u6587\u6863\u3002"),(0,n.kt)("p",null,"\u539f\u751f\u6a21\u5757\u8fd8\u53ef\u4ee5\u4f7f\u7528 promise \u6765\u7b80\u5316\u4ee3\u7801\uff0c\u642d\u914d ES2016(ES7)\u6807\u51c6\u7684",(0,n.kt)("inlineCode",{parentName:"p"},"async/await"),"\u8bed\u6cd5\u5219\u6548\u679c\u66f4\u4f73\u3002\u5982\u679c\u6865\u63a5\u539f\u751f\u65b9\u6cd5\u7684\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a",(0,n.kt)("inlineCode",{parentName:"p"},"Promise"),"\uff0c\u5219\u5bf9\u5e94\u7684 JS \u65b9\u6cd5\u5c31\u4f1a\u8fd4\u56de\u4e00\u4e2a Promise \u5bf9\u8c61\u3002"),(0,n.kt)("p",null,"\u6211\u4eec\u628a\u4e0a\u9762\u7684\u4ee3\u7801\u7528 promise \u6765\u4ee3\u66ff\u56de\u8c03\u8fdb\u884c\u91cd\u6784\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'import com.facebook.react.bridge.Promise;\n\npublic class UIManagerModule extends ReactContextBaseJavaModule {\n\n...\n  private static final String E_LAYOUT_ERROR = "E_LAYOUT_ERROR";\n  @ReactMethod\n  public void measureLayout(\n      int tag,\n      int ancestorTag,\n      Promise promise) {\n    try {\n      measureLayout(tag, ancestorTag, mMeasureBuffer);\n\n      WritableMap map = Arguments.createMap();\n\n      map.putDouble("relativeX", PixelUtil.toDIPFromPixel(mMeasureBuffer[0]));\n      map.putDouble("relativeY", PixelUtil.toDIPFromPixel(mMeasureBuffer[1]));\n      map.putDouble("width", PixelUtil.toDIPFromPixel(mMeasureBuffer[2]));\n      map.putDouble("height", PixelUtil.toDIPFromPixel(mMeasureBuffer[3]));\n\n      promise.resolve(map);\n    } catch (IllegalViewOperationException e) {\n      promise.reject(E_LAYOUT_ERROR, e);\n    }\n  }\n\n...\n')),(0,n.kt)("p",null,"\u73b0\u5728 JavaScript \u7aef\u7684\u65b9\u6cd5\u4f1a\u8fd4\u56de\u4e00\u4e2a Promise\u3002\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u5728\u4e00\u4e2a\u58f0\u660e\u4e86",(0,n.kt)("inlineCode",{parentName:"p"},"async"),"\u7684\u5f02\u6b65\u51fd\u6570\u5185\u4f7f\u7528",(0,n.kt)("inlineCode",{parentName:"p"},"await"),"\u5173\u952e\u5b57\u6765\u8c03\u7528\uff0c\u5e76\u7b49\u5f85\u5176\u7ed3\u679c\u8fd4\u56de\u3002\uff08\u867d\u7136\u8fd9\u6837\u5199\u7740\u770b\u8d77\u6765\u50cf\u540c\u6b65\u64cd\u4f5c\uff0c\u4f46\u5b9e\u9645\u4ecd\u7136\u662f\u5f02\u6b65\u7684\uff0c\u5e76\u4e0d\u4f1a\u963b\u585e\u6267\u884c\u6765\u7b49\u5f85\uff09\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"async function measureLayout() {\n  try {\n    const {\n      relativeX,\n      relativeY,\n      width,\n      height\n    } = await UIManager.measureLayout(100, 100);\n\n    console.log(\n      relativeX + ':' + relativeY + ':' + width + ':' + height\n    );\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nmeasureLayout();\n")),(0,n.kt)("h3",u({},{id:"\u591a\u7ebf\u7a0b"}),"\u591a\u7ebf\u7a0b"),(0,n.kt)("p",null,"\u539f\u751f\u6a21\u5757\u4e0d\u5e94\u5bf9\u81ea\u5df1\u88ab\u8c03\u7528\u65f6\u6240\u5904\u7684\u7ebf\u7a0b\u505a\u4efb\u4f55\u5047\u8bbe\uff0c\u5f53\u524d\u7684\u72b6\u51b5\u6709\u53ef\u80fd\u4f1a\u5728\u5c06\u6765\u7684\u7248\u672c\u4e2d\u6539\u53d8\u3002\u5982\u679c\u4e00\u4e2a\u8fc7\u7a0b\u8981\u963b\u585e\u6267\u884c\u4e00\u6bb5\u65f6\u95f4\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u5e94\u5f53\u5206\u914d\u5230\u4e00\u4e2a\u5185\u90e8\u7ba1\u7406\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u7136\u540e\u4ece\u90a3\u8fb9\u53ef\u4ee5\u8c03\u7528\u4efb\u610f\u7684\u56de\u8c03\u51fd\u6570\u3002",(0,n.kt)("em",{parentName:"p"},"\u8bd1\u6ce8"),"\uff1a\u6211\u4eec\u901a\u5e38\u7528 AsyncTask \u6765\u5b8c\u6210\u8fd9\u9879\u5de5\u4f5c\u3002"),(0,n.kt)("h3",u({},{id:"\u53d1\u9001\u4e8b\u4ef6\u5230-javascript"}),"\u53d1\u9001\u4e8b\u4ef6\u5230 JavaScript"),(0,n.kt)("p",null,"\u539f\u751f\u6a21\u5757\u53ef\u4ee5\u5728\u6ca1\u6709\u88ab\u8c03\u7528\u7684\u60c5\u51b5\u4e0b\u5f80 JavaScript \u53d1\u9001\u4e8b\u4ef6\u901a\u77e5\u3002\u6700\u7b80\u5355\u7684\u529e\u6cd5\u5c31\u662f\u901a\u8fc7",(0,n.kt)("inlineCode",{parentName:"p"},"RCTDeviceEventEmitter"),"\uff0c\u8fd9\u53ef\u4ee5\u901a\u8fc7",(0,n.kt)("inlineCode",{parentName:"p"},"ReactContext"),"\u6765\u83b7\u5f97\u5bf9\u5e94\u7684\u5f15\u7528\uff0c\u50cf\u8fd9\u6837\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'...\nimport com.facebook.react.modules.core.DeviceEventManagerModule;\nimport com.facebook.react.bridge.WritableMap;\nimport com.facebook.react.bridge.Arguments;\n...\nprivate void sendEvent(ReactContext reactContext,\n                       String eventName,\n                       @Nullable WritableMap params) {\n  reactContext\n      .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)\n      .emit(eventName, params);\n}\n@ReactMethod\npublic void addListener(String eventName) {\n  // Set up any upstream listeners or background tasks as necessary\n}\n@ReactMethod\npublic void removeListeners(Integer count) {\n  // Remove upstream listeners, stop unnecessary background tasks\n}\n...\nWritableMap params = Arguments.createMap();\nparams.putString("eventProperty", "someValue");\n...\nsendEvent(reactContext, "EventReminder", params);\n')),(0,n.kt)("p",null,"JavaScript \u6a21\u5757\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528",(0,n.kt)("inlineCode",{parentName:"p"},"NativeEventEmitter"),"\u6a21\u5757\u6765\u76d1\u542c\u4e8b\u4ef6\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"import { NativeEventEmitter, NativeModules } from 'react-native';\n// ...\n\n  componentDidMount() {\n    // ...\n    const eventEmitter = new NativeEventEmitter(NativeModules.ToastExample);\n    this.eventListener = eventEmitter.addListener('EventReminder', (event) => {\n       console.log(event.eventProperty) // \"someValue\"\n    });\n    // ...\n  }\n  componentWillUnmount() {\n    this.eventListener.remove(); // \u7ec4\u4ef6\u5378\u8f7d\u65f6\u8bb0\u5f97\u79fb\u9664\u76d1\u542c\u4e8b\u4ef6\n  }\n")),(0,n.kt)("h3",u({},{id:"\u4ecestartactivityforresult\u4e2d\u83b7\u53d6\u7ed3\u679c"}),"\u4ece",(0,n.kt)("inlineCode",{parentName:"h3"},"startActivityForResult"),"\u4e2d\u83b7\u53d6\u7ed3\u679c"),(0,n.kt)("p",null,"\u5982\u679c\u4f60\u4f7f\u7528",(0,n.kt)("inlineCode",{parentName:"p"},"startActivityForResult"),"\u8c03\u8d77\u4e86\u4e00\u4e2a activity \u5e76\u60f3\u4ece\u5176\u4e2d\u83b7\u53d6\u8fd4\u56de\u7ed3\u679c\uff0c\u90a3\u4e48\u4f60\u9700\u8981\u76d1\u542c",(0,n.kt)("inlineCode",{parentName:"p"},"onActivityResult"),"\u4e8b\u4ef6\u3002\u5177\u4f53\u7684\u505a\u6cd5\u662f\u7ee7\u627f",(0,n.kt)("inlineCode",{parentName:"p"},"BaseActivityEventListener"),"\u6216\u662f\u5b9e\u73b0",(0,n.kt)("inlineCode",{parentName:"p"},"ActivityEventListener"),"\u3002\u6211\u4eec\u63a8\u8350\u524d\u4e00\u79cd\u505a\u6cd5\uff0c\u56e0\u4e3a\u5b83\u76f8\u5bf9\u6765\u8bf4\u4e0d\u592a\u4f1a\u53d7\u5230 API \u53d8\u66f4\u7684\u5f71\u54cd\u3002\u7136\u540e\u4f60\u9700\u8981\u5728\u6a21\u5757\u7684\u6784\u9020\u51fd\u6570\u4e2d\u6ce8\u518c\u8fd9\u4e00\u76d1\u542c\u4e8b\u4ef6\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"reactContext.addActivityEventListener(mActivityResultListener);\n")),(0,n.kt)("p",null,"\u73b0\u5728\u4f60\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199\u4e0b\u9762\u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\u5bf9",(0,n.kt)("inlineCode",{parentName:"p"},"onActivityResult"),"\u7684\u76d1\u542c\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"@Override\npublic void onActivityResult(\n  final Activity activity,\n  final int requestCode,\n  final int resultCode,\n  final Intent intent) {\n  // \u5728\u8fd9\u91cc\u5b9e\u73b0\u4f60\u81ea\u5df1\u7684\u903b\u8f91\n}\n")),(0,n.kt)("p",null,"\u4e0b\u9762\u6211\u4eec\u5199\u4e00\u4e2a\u7b80\u5355\u7684\u56fe\u7247\u9009\u62e9\u5668\u6765\u5b9e\u8df5\u4e00\u4e0b\u3002\u8fd9\u4e2a\u56fe\u7247\u9009\u62e9\u5668\u4f1a\u628a",(0,n.kt)("inlineCode",{parentName:"p"},"pickImage"),"\u65b9\u6cd5\u66b4\u9732\u7ed9 JavaScript\uff0c\u800c\u8fd9\u4e2a\u65b9\u6cd5\u5728\u8c03\u7528\u65f6\u5c31\u4f1a\u628a\u56fe\u7247\u7684\u8def\u5f84\u8fd4\u56de\u5230 JS \u7aef\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'public class ImagePickerModule extends ReactContextBaseJavaModule {\n\n  private static final int IMAGE_PICKER_REQUEST = 467081;\n  private static final String E_ACTIVITY_DOES_NOT_EXIST = "E_ACTIVITY_DOES_NOT_EXIST";\n  private static final String E_PICKER_CANCELLED = "E_PICKER_CANCELLED";\n  private static final String E_FAILED_TO_SHOW_PICKER = "E_FAILED_TO_SHOW_PICKER";\n  private static final String E_NO_IMAGE_DATA_FOUND = "E_NO_IMAGE_DATA_FOUND";\n\n  private Promise mPickerPromise;\n\n  private final ActivityEventListener mActivityEventListener = new BaseActivityEventListener() {\n\n    @Override\n    public void onActivityResult(Activity activity, int requestCode, int resultCode, Intent intent) {\n      if (requestCode == IMAGE_PICKER_REQUEST) {\n        if (mPickerPromise != null) {\n          if (resultCode == Activity.RESULT_CANCELED) {\n            mPickerPromise.reject(E_PICKER_CANCELLED, "Image picker was cancelled");\n          } else if (resultCode == Activity.RESULT_OK) {\n            Uri uri = intent.getData();\n\n            if (uri == null) {\n              mPickerPromise.reject(E_NO_IMAGE_DATA_FOUND, "No image data found");\n            } else {\n              mPickerPromise.resolve(uri.toString());\n            }\n          }\n\n          mPickerPromise = null;\n        }\n      }\n    }\n  };\n\n  ImagePickerModule(ReactApplicationContext reactContext) {\n    super(reactContext);\n\n    // Add the listener for `onActivityResult`\n    reactContext.addActivityEventListener(mActivityEventListener);\n  }\n\n  @Override\n  public String getName() {\n    return "ImagePickerModule";\n  }\n\n  @ReactMethod\n  public void pickImage(final Promise promise) {\n    Activity currentActivity = getCurrentActivity();\n\n    if (currentActivity == null) {\n      promise.reject(E_ACTIVITY_DOES_NOT_EXIST, "Activity doesn\'t exist");\n      return;\n    }\n\n    // Store the promise to resolve/reject when picker returns data\n    mPickerPromise = promise;\n\n    try {\n      final Intent galleryIntent = new Intent(Intent.ACTION_PICK);\n\n      galleryIntent.setType("image/*");\n\n      final Intent chooserIntent = Intent.createChooser(galleryIntent, "Pick an image");\n\n      currentActivity.startActivityForResult(chooserIntent, IMAGE_PICKER_REQUEST);\n    } catch (Exception e) {\n      mPickerPromise.reject(E_FAILED_TO_SHOW_PICKER, e);\n      mPickerPromise = null;\n    }\n  }\n}\n')),(0,n.kt)("h3",u({},{id:"\u76d1\u542c\u751f\u547d\u5468\u671f\u4e8b\u4ef6"}),"\u76d1\u542c\u751f\u547d\u5468\u671f\u4e8b\u4ef6"),(0,n.kt)("p",null,"\u76d1\u542c activity \u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\uff08\u6bd4\u5982",(0,n.kt)("inlineCode",{parentName:"p"},"onResume"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"onPause"),"\u7b49\u7b49\uff09\u548c\u6211\u4eec\u5728\u524d\u9762\u5b9e\u73b0 ",(0,n.kt)("inlineCode",{parentName:"p"},"ActivityEventListener"),"\u7684\u505a\u6cd5\u7c7b\u4f3c\u3002\u6a21\u5757\u5fc5\u987b\u5b9e\u73b0",(0,n.kt)("inlineCode",{parentName:"p"},"LifecycleEventListener"),"\uff0c\u7136\u540e\u9700\u8981\u5728\u6784\u9020\u51fd\u6570\u4e2d\u6ce8\u518c\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"reactContext.addLifecycleEventListener(this);\n")),(0,n.kt)("p",null,"\u73b0\u5728\u4f60\u53ef\u4ee5\u901a\u8fc7\u5b9e\u73b0\u4e0b\u5217\u65b9\u6cd5\u6765\u76d1\u542c activity \u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u4e86\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"@Override\npublic void onHostResume() {\n    // Activity `onResume`\n}\n\n@Override\npublic void onHostPause() {\n    // Activity `onPause`\n}\n\n@Override\npublic void onHostDestroy() {\n    // Activity `onDestroy`\n}\n")))}N.isMDXComponent=!0}}]);