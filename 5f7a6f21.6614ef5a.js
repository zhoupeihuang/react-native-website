(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{215:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return c})),t.d(n,"metadata",(function(){return o})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return p}));var a=t(3),r=t(8),i=(t(0),t(413)),c={id:"native-modules-ios",title:"iOS \u539f\u751f\u6a21\u5757"},o={unversionedId:"native-modules-ios",id:"native-modules-ios",isDocsHomePage:!1,title:"iOS \u539f\u751f\u6a21\u5757",description:"\u6709\u65f6\u5019 App \u9700\u8981\u8bbf\u95ee\u5e73\u53f0 API\uff0c\u4f46 React Native \u53ef\u80fd\u8fd8\u6ca1\u6709\u76f8\u5e94\u7684\u6a21\u5757\u5c01\u88c5\uff1b\u6216\u8005\u4f60\u9700\u8981\u590d\u7528 Objective-C\u3001Swift \u6216 C++\u4ee3\u7801\uff0c\u800c\u4e0d\u662f\u7528 JavaScript \u91cd\u65b0\u5b9e\u73b0\u4e00\u904d\uff1b\u53c8\u6216\u8005\u4f60\u9700\u8981\u5b9e\u73b0\u67d0\u4e9b\u9ad8\u6027\u80fd\u3001\u591a\u7ebf\u7a0b\u7684\u4ee3\u7801\uff0c\u8b6c\u5982\u56fe\u7247\u5904\u7406\u3001\u6570\u636e\u5e93\u3001\u6216\u8005\u5404\u79cd\u9ad8\u7ea7\u6269\u5c55\u7b49\u7b49\u3002",source:"@site/../cndocs/native-modules-ios.md",slug:"/native-modules-ios",permalink:"/docs/next/native-modules-ios",editUrl:"https://github.com/reactnativecn/react-native-website/blob/production/cnwebsite/../cndocs/native-modules-ios.md",version:"current",lastUpdatedAt:1610508057,sidebar:"docs",previous:{title:"Android \u539f\u751f\u6a21\u5757",permalink:"/docs/next/native-modules-android"},next:{title:"\u539f\u751f\u6a21\u5757\u914d\u7f6e",permalink:"/docs/next/native-modules-setup"}},l=[{value:"Native Module Setup",id:"native-module-setup",children:[]},{value:"iOS \u65e5\u5386\u6a21\u5757\u6f14\u793a",id:"ios-\u65e5\u5386\u6a21\u5757\u6f14\u793a",children:[]},{value:"\u53c2\u6570\u7c7b\u578b",id:"\u53c2\u6570\u7c7b\u578b",children:[]},{value:"\u56de\u8c03\u51fd\u6570",id:"\u56de\u8c03\u51fd\u6570",children:[]},{value:"Promises",id:"promises",children:[]},{value:"\u591a\u7ebf\u7a0b",id:"\u591a\u7ebf\u7a0b",children:[]},{value:"\u4f9d\u8d56\u6ce8\u5165",id:"\u4f9d\u8d56\u6ce8\u5165",children:[]},{value:"\u5bfc\u51fa\u5e38\u91cf",id:"\u5bfc\u51fa\u5e38\u91cf",children:[{value:"\u5b9e\u73b0 <code>+ requiresMainQueueSetup</code>",id:"\u5b9e\u73b0--requiresmainqueuesetup",children:[]}]},{value:"\u7ed9 JavaScript \u7aef\u53d1\u9001\u4e8b\u4ef6",id:"\u7ed9-javascript-\u7aef\u53d1\u9001\u4e8b\u4ef6",children:[{value:"\u4f18\u5316\u65e0\u76d1\u542c\u5904\u7406\u7684\u4e8b\u4ef6",id:"\u4f18\u5316\u65e0\u76d1\u542c\u5904\u7406\u7684\u4e8b\u4ef6",children:[]}]},{value:"\u4ece Swift \u5bfc\u51fa",id:"\u4ece-swift-\u5bfc\u51fa",children:[]},{value:"Reserved Method Names",id:"reserved-method-names",children:[{value:"invalidate()",id:"invalidate",children:[]}]}],b={toc:l};function p(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},b,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"\u6709\u65f6\u5019 App \u9700\u8981\u8bbf\u95ee\u5e73\u53f0 API\uff0c\u4f46 React Native \u53ef\u80fd\u8fd8\u6ca1\u6709\u76f8\u5e94\u7684\u6a21\u5757\u5c01\u88c5\uff1b\u6216\u8005\u4f60\u9700\u8981\u590d\u7528 Objective-C\u3001Swift \u6216 C++\u4ee3\u7801\uff0c\u800c\u4e0d\u662f\u7528 JavaScript \u91cd\u65b0\u5b9e\u73b0\u4e00\u904d\uff1b\u53c8\u6216\u8005\u4f60\u9700\u8981\u5b9e\u73b0\u67d0\u4e9b\u9ad8\u6027\u80fd\u3001\u591a\u7ebf\u7a0b\u7684\u4ee3\u7801\uff0c\u8b6c\u5982\u56fe\u7247\u5904\u7406\u3001\u6570\u636e\u5e93\u3001\u6216\u8005\u5404\u79cd\u9ad8\u7ea7\u6269\u5c55\u7b49\u7b49\u3002"),Object(i.b)("p",null,"\u6211\u4eec\u628a React Native \u8bbe\u8ba1\u4e3a\u53ef\u4ee5\u5728\u5176\u57fa\u7840\u4e0a\u7f16\u5199\u771f\u6b63\u7684\u539f\u751f\u4ee3\u7801\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bbf\u95ee\u5e73\u53f0\u6240\u6709\u7684\u80fd\u529b\u3002\u8fd9\u662f\u4e00\u4e2a\u76f8\u5bf9\u9ad8\u7ea7\u7684\u7279\u6027\uff0c\u6211\u4eec\u5e76\u4e0d\u8ba4\u4e3a\u5b83\u5e94\u5f53\u5728\u65e5\u5e38\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\u7ecf\u5e38\u51fa\u73b0\uff0c\u4f46\u5177\u5907\u8fd9\u6837\u7684\u80fd\u529b\u662f\u5f88\u91cd\u8981\u7684\u3002\u5982\u679c React Native \u8fd8\u4e0d\u652f\u6301\u67d0\u4e2a\u4f60\u9700\u8981\u7684\u539f\u751f\u7279\u6027\uff0c\u4f60\u5e94\u5f53\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u8be5\u7279\u6027\u7684\u5c01\u88c5\u3002"),Object(i.b)("p",null,"\u672c\u6587\u662f\u5173\u4e8e\u5982\u4f55\u5c01\u88c5\u539f\u751f\u6a21\u5757\u7684\u9ad8\u7ea7\u5411\u5bfc\uff0c\u6211\u4eec\u5047\u8bbe\u60a8\u5df2\u7ecf\u5177\u5907 Objective-C \u6216\u8005 Swift\uff0c\u4ee5\u53ca iOS \u6838\u5fc3\u5e93\uff08Foundation\u3001UIKit\uff09\u7684\u76f8\u5173\u77e5\u8bc6\u3002"),Object(i.b)("h2",{id:"native-module-setup"},"Native Module Setup"),Object(i.b)("p",null,"Native modules are usually distributed as npm packages, except that for them to be native modules they will contain an Xcode library project. To get the basic scaffolding make sure to read ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"native-modules-setup"}),"Native Modules Setup")," guide first."),Object(i.b)("h2",{id:"ios-\u65e5\u5386\u6a21\u5757\u6f14\u793a"},"iOS \u65e5\u5386\u6a21\u5757\u6f14\u793a"),Object(i.b)("p",null,"\u672c\u5411\u5bfc\u5c06\u4f1a\u7528",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://developer.apple.com/library/mac/documentation/DataManagement/Conceptual/EventKitProgGuide/Introduction/Introduction.html"}),"iOS \u65e5\u5386 API"),"\u4f5c\u4e3a\u793a\u4f8b\u3002\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u5728 Javascript \u4e2d\u53ef\u4ee5\u8bbf\u95ee\u5230 iOS \u7684\u65e5\u5386\u529f\u80fd\u3002"),Object(i.b)("p",null,"\u5728 React Native \u4e2d\uff0c\u4e00\u4e2a\u201c\u539f\u751f\u6a21\u5757\u201d\u5c31\u662f\u4e00\u4e2a\u5b9e\u73b0\u4e86\u201cRCTBridgeModule\u201d\u534f\u8bae\u7684 Objective-C \u7c7b\uff0c\u5176\u4e2d RCT \u662f ReaCT \u7684\u7f29\u5199\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"// CalendarManager.h\n#import <React/RCTBridgeModule.h>\n\n@interface CalendarManager : NSObject <RCTBridgeModule>\n@end\n")),Object(i.b)("p",null,"\u4e3a\u4e86\u5b9e\u73b0",Object(i.b)("inlineCode",{parentName:"p"},"RCTBridgeModule"),"\u534f\u8bae\uff0c\u4f60\u7684\u7c7b\u9700\u8981\u5305\u542b",Object(i.b)("inlineCode",{parentName:"p"},"RCT_EXPORT_MODULE()"),"\u5b8f\u3002\u8fd9\u4e2a\u5b8f\u4e5f\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u53c2\u6570\u7528\u6765\u6307\u5b9a\u5728 JavaScript \u4e2d\u8bbf\u95ee\u8fd9\u4e2a\u6a21\u5757\u7684\u540d\u5b57\u3002\u5982\u679c\u4f60\u4e0d\u6307\u5b9a\uff0c\u9ed8\u8ba4\u5c31\u4f1a\u4f7f\u7528\u8fd9\u4e2a Objective-C \u7c7b\u7684\u540d\u5b57\u3002\u5982\u679c\u7c7b\u540d\u4ee5 RCT \u5f00\u5934\uff0c\u5219 JavaScript \u7aef\u5f15\u5165\u7684\u6a21\u5757\u540d\u4f1a\u81ea\u52a8\u79fb\u9664\u8fd9\u4e2a\u524d\u7f00\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'// CalendarManager.m\n#import "CalendarManager.h"\n\n@implementation CalendarManager\n\n// To export a module named CalendarManager\nRCT_EXPORT_MODULE();\n\n// This would name the module AwesomeCalendarManager instead\n// RCT_EXPORT_MODULE(AwesomeCalendarManager);\n\n@end\n')),Object(i.b)("p",null,"\u4f60\u5fc5\u987b\u660e\u786e\u7684\u58f0\u660e\u8981\u7ed9 JavaScript \u5bfc\u51fa\u7684\u65b9\u6cd5\uff0c\u5426\u5219 React Native \u4e0d\u4f1a\u5bfc\u51fa\u4efb\u4f55\u65b9\u6cd5\u3002\u58f0\u660e\u901a\u8fc7",Object(i.b)("inlineCode",{parentName:"p"},"RCT_EXPORT_METHOD()"),"\u5b8f\u6765\u5b9e\u73b0\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'#import "CalendarManager.h"\n#import <React/RCTLog.h>\n\n@implementation CalendarManager\n\nRCT_EXPORT_MODULE();\n\nRCT_EXPORT_METHOD(addEvent:(NSString *)name location:(NSString *)location)\n{\n  RCTLogInfo(@"Pretending to create an event %@ at %@", name, location);\n}\n\n@end\n')),Object(i.b)("p",null,"\u73b0\u5728\u4ece Javascript \u91cc\u53ef\u4ee5\u8fd9\u6837\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"import { NativeModules } from 'react-native';\nconst CalendarManager = NativeModules.CalendarManager;\nCalendarManager.addEvent(\n  'Birthday Party',\n  '4 Privet Drive, Surrey'\n);\n")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("strong",{parentName:"p"},"NOTE"),": JavaScript method names"),Object(i.b)("p",{parentName:"blockquote"},"The name of the method exported to JavaScript is the native method's name up to the first colon. React Native also defines a macro called ",Object(i.b)("inlineCode",{parentName:"p"},"RCT_REMAP_METHOD()")," to specify the JavaScript method's name. This is useful when multiple native methods are the same up to the first colon and would have conflicting JavaScript names.")),Object(i.b)("p",null,"The CalendarManager module is instantiated on the Objective-C side using a ","[CalendarManager new]"," call. The return type of bridge methods is always ",Object(i.b)("inlineCode",{parentName:"p"},"void"),". React Native bridge is asynchronous, so the only way to pass a result to JavaScript is by using callbacks or emitting events (see below)."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("strong",{parentName:"p"},"\u6ce8\u610f"),": JavaScript \u65b9\u6cd5\u540d"),Object(i.b)("p",{parentName:"blockquote"},"\u5bfc\u51fa\u5230 JavaScript \u7684\u65b9\u6cd5\u540d\u662f Objective-C \u7684\u65b9\u6cd5\u540d\u7684\u7b2c\u4e00\u4e2a\u90e8\u5206\u3002React Native \u8fd8\u5b9a\u4e49\u4e86\u4e00\u4e2a",Object(i.b)("inlineCode",{parentName:"p"},"RCT_REMAP_METHOD()"),"\u5b8f\uff0c\u5b83\u53ef\u4ee5\u6307\u5b9a JavaScript \u65b9\u6cd5\u540d\u3002\u56e0\u4e3a JavaScript \u7aef\u4e0d\u80fd\u6709\u540c\u540d\u4e0d\u540c\u53c2\u7684\u65b9\u6cd5\u5b58\u5728\uff0c\u6240\u4ee5\u5f53\u539f\u751f\u7aef\u5b58\u5728\u91cd\u8f7d\u65b9\u6cd5\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u5b8f\u6765\u907f\u514d\u5728 JavaScript \u7aef\u7684\u540d\u5b57\u51b2\u7a81\u3002")),Object(i.b)("p",null,"\u6865\u63a5\u5230 JavaScript \u7684\u65b9\u6cd5\u8fd4\u56de\u503c\u7c7b\u578b\u5fc5\u987b\u662f",Object(i.b)("inlineCode",{parentName:"p"},"void"),"\u3002React Native \u7684\u6865\u63a5\u64cd\u4f5c\u662f\u5f02\u6b65\u7684\uff0c\u6240\u4ee5\u8981\u8fd4\u56de\u7ed3\u679c\u7ed9 JavaScript\uff0c\u4f60\u5fc5\u987b\u901a\u8fc7\u56de\u8c03\u6216\u8005\u89e6\u53d1\u4e8b\u4ef6\u6765\u8fdb\u884c\u3002\uff08\u53c2\u89c1\u672c\u6587\u6863\u540e\u9762\u7684\u90e8\u5206\uff09"),Object(i.b)("h2",{id:"\u53c2\u6570\u7c7b\u578b"},"\u53c2\u6570\u7c7b\u578b"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"RCT_EXPORT_METHOD")," \u652f\u6301\u6240\u6709\u6807\u51c6 JSON \u7c7b\u578b\uff0c\u5305\u62ec\uff1a"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"string (",Object(i.b)("inlineCode",{parentName:"li"},"NSString"),")"),Object(i.b)("li",{parentName:"ul"},"number (",Object(i.b)("inlineCode",{parentName:"li"},"NSInteger"),", ",Object(i.b)("inlineCode",{parentName:"li"},"float"),", ",Object(i.b)("inlineCode",{parentName:"li"},"double"),", ",Object(i.b)("inlineCode",{parentName:"li"},"CGFloat"),", ",Object(i.b)("inlineCode",{parentName:"li"},"NSNumber"),")"),Object(i.b)("li",{parentName:"ul"},"boolean (",Object(i.b)("inlineCode",{parentName:"li"},"BOOL"),", ",Object(i.b)("inlineCode",{parentName:"li"},"NSNumber"),")"),Object(i.b)("li",{parentName:"ul"},"array (",Object(i.b)("inlineCode",{parentName:"li"},"NSArray"),") \u53ef\u5305\u542b\u672c\u5217\u8868\u4e2d\u4efb\u610f\u7c7b\u578b"),Object(i.b)("li",{parentName:"ul"},"object (",Object(i.b)("inlineCode",{parentName:"li"},"NSDictionary"),") \u53ef\u5305\u542b string \u7c7b\u578b\u7684\u952e\u548c\u672c\u5217\u8868\u4e2d\u4efb\u610f\u7c7b\u578b\u7684\u503c"),Object(i.b)("li",{parentName:"ul"},"function (",Object(i.b)("inlineCode",{parentName:"li"},"RCTResponseSenderBlock"),")")),Object(i.b)("p",null,"\u9664\u6b64\u4ee5\u5916\uff0c\u4efb\u4f55",Object(i.b)("inlineCode",{parentName:"p"},"RCTConvert"),"\u7c7b\u652f\u6301\u7684\u7684\u7c7b\u578b\u4e5f\u90fd\u53ef\u4ee5\u4f7f\u7528(\u53c2\u89c1",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/master/React/Base/RCTConvert.h"}),Object(i.b)("inlineCode",{parentName:"a"},"RCTConvert")),"\u4e86\u89e3\u66f4\u591a\u4fe1\u606f)\u3002",Object(i.b)("inlineCode",{parentName:"p"},"RCTConvert"),"\u8fd8\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u8f85\u52a9\u51fd\u6570\uff0c\u7528\u6765\u63a5\u6536\u4e00\u4e2a JSON \u503c\u5e76\u8f6c\u6362\u5230\u539f\u751f Objective-C \u7c7b\u578b\u6216\u7c7b\u3002"),Object(i.b)("p",null,"\u5728\u6211\u4eec\u7684",Object(i.b)("inlineCode",{parentName:"p"},"CalendarManager"),"\u4f8b\u5b50\u91cc\uff0c\u6211\u4eec\u9700\u8981\u628a\u4e8b\u4ef6\u7684\u65f6\u95f4\u4ea4\u7ed9\u539f\u751f\u65b9\u6cd5\u3002\u6211\u4eec\u4e0d\u80fd\u5728\u6865\u63a5\u901a\u9053\u91cc\u4f20\u9012 Date \u5bf9\u8c61\uff0c\u6240\u4ee5\u9700\u8981\u628a\u65e5\u671f\u8f6c\u5316\u6210\u5b57\u7b26\u4e32\u6216\u6570\u5b57\u6765\u4f20\u9012\u3002\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5b9e\u73b0\u539f\u751f\u51fd\u6570\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"RCT_EXPORT_METHOD(addEvent:(NSString *)name location:(NSString *)location date:(nonnull NSNumber *)secondsSinceUnixEpoch)\n{\n  NSDate *date = [RCTConvert NSDate:secondsSinceUnixEpoch];\n}\n")),Object(i.b)("p",null,"\u6216\u8005\u8fd9\u6837\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"RCT_EXPORT_METHOD(addEvent:(NSString *)name location:(NSString *)location date:(NSString *)ISO8601DateString)\n{\n  NSDate *date = [RCTConvert NSDate:ISO8601DateString];\n}\n")),Object(i.b)("p",null,"\u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u4f9d\u9760\u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\u7684\u7279\u6027\uff0c\u8df3\u8fc7\u624b\u52a8\u7684\u7c7b\u578b\u8f6c\u6362\uff0c\u800c\u76f4\u63a5\u8fd9\u4e48\u5199\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"RCT_EXPORT_METHOD(addEvent:(NSString *)name location:(NSString *)location date:(NSDate *)date)\n{\n  // Date is ready to use!\n}\n")),Object(i.b)("p",null,"\u5bf9\u5e94 JavaScript \u7aef\u65e2\u53ef\u4ee5\u8fd9\u6837\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"CalendarManager.addEvent(\n  'Birthday Party',\n  '4 Privet Drive, Surrey',\n  date.getTime()\n); // \u628a\u65e5\u671f\u4ee5unix\u65f6\u95f4\u6233\u5f62\u5f0f\u4f20\u9012\n")),Object(i.b)("p",null,"\u4e5f\u53ef\u4ee5\u8fd9\u6837\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"CalendarManager.addEvent(\n  'Birthday Party',\n  '4 Privet Drive, Surrey',\n  date.toISOString()\n); // \u628a\u65e5\u671f\u4ee5ISO-8601\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\u4f20\u9012\n")),Object(i.b)("p",null,"\u4e24\u4e2a\u503c\u90fd\u4f1a\u88ab\u8f6c\u6362\u4e3a\u6b63\u786e\u7684",Object(i.b)("inlineCode",{parentName:"p"},"NSDate"),"\u7c7b\u578b\u3002\u4f46\u5982\u679c\u63d0\u4f9b\u4e00\u4e2a\u4e0d\u5408\u6cd5\u7684\u503c\uff0c\u8b6c\u5982\u4e00\u4e2a",Object(i.b)("inlineCode",{parentName:"p"},"Array"),"\uff0c\u5219\u4f1a\u4ea7\u751f\u4e00\u4e2a\u201c\u7ea2\u5c4f\u201d\u62a5\u9519\u4fe1\u606f\u3002"),Object(i.b)("p",null,"\u968f\u7740",Object(i.b)("inlineCode",{parentName:"p"},"CalendarManager.addEvent"),"\u65b9\u6cd5\u53d8\u5f97\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u53c2\u6570\u7684\u4e2a\u6570\u8d8a\u6765\u8d8a\u591a\uff0c\u5176\u4e2d\u6709\u4e00\u4e9b\u53ef\u80fd\u662f\u53ef\u9009\u7684\u53c2\u6570\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u5e94\u8be5\u8003\u8651\u4fee\u6539\u6211\u4eec\u7684 API\uff0c\u7528\u4e00\u4e2a dictionary \u6765\u5b58\u653e\u6240\u6709\u7684\u4e8b\u4ef6\u53c2\u6570\uff0c\u50cf\u8fd9\u6837\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'#import <React/RCTConvert.h>\n\nRCT_EXPORT_METHOD(addEvent:(NSString *)name details:(NSDictionary *)details)\n{\n  NSString *location = [RCTConvert NSString:details[@"location"]];\n  NSDate *time = [RCTConvert NSDate:details[@"time"]];\n  ...\n}\n')),Object(i.b)("p",null,"\u7136\u540e\u5728 JS \u91cc\u8fd9\u6837\u8c03\u7528\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"CalendarManager.addEvent('Birthday Party', {\n  location: '4 Privet Drive, Surrey',\n  time: date.getTime(),\n  description: '...'\n});\n")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("strong",{parentName:"p"},"\u6ce8\u610f"),": \u5173\u4e8e\u6570\u7ec4\u548c\u6620\u5c04"),Object(i.b)("p",{parentName:"blockquote"},"Objective-C \u5e76\u6ca1\u6709\u63d0\u4f9b\u786e\u4fdd\u8fd9\u4e9b\u7ed3\u6784\u4f53\u5185\u90e8\u503c\u7684\u7c7b\u578b\u7684\u65b9\u5f0f\u3002\u4f60\u7684\u539f\u751f\u6a21\u5757\u53ef\u80fd\u5e0c\u671b\u6536\u5230\u4e00\u4e2a\u5b57\u7b26\u4e32\u6570\u7ec4\uff0c\u4f46\u5982\u679c JavaScript \u5728\u8c03\u7528\u7684\u65f6\u5019\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6df7\u5408 number \u548c string \u7684\u6570\u7ec4\uff0c\u4f60\u4f1a\u6536\u5230\u4e00\u4e2a",Object(i.b)("inlineCode",{parentName:"p"},"NSArray"),"\uff0c\u91cc\u9762\u65e2\u6709",Object(i.b)("inlineCode",{parentName:"p"},"NSNumber"),"\u4e5f\u6709",Object(i.b)("inlineCode",{parentName:"p"},"NSString"),"\u3002\u5bf9\u4e8e\u6570\u7ec4\u6765\u8bf4\uff0c",Object(i.b)("inlineCode",{parentName:"p"},"RCTConvert"),"\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7c7b\u578b\u5316\u7684\u96c6\u5408\uff0c\u8b6c\u5982",Object(i.b)("inlineCode",{parentName:"p"},"NSStringArray"),"\u6216\u8005",Object(i.b)("inlineCode",{parentName:"p"},"UIColorArray"),"\uff0c\u4f60\u53ef\u4ee5\u7528\u5728\u4f60\u7684\u51fd\u6570\u58f0\u660e\u4e2d\u3002\u5bf9\u4e8e\u6620\u5c04\u800c\u8a00\uff0c\u5f00\u53d1\u8005\u6709\u8d23\u4efb\u81ea\u5df1\u8c03\u7528",Object(i.b)("inlineCode",{parentName:"p"},"RCTConvert"),"\u7684\u8f85\u52a9\u65b9\u6cd5\u6765\u68c0\u6d4b\u548c\u8f6c\u6362\u503c\u7684\u7c7b\u578b\u3002")),Object(i.b)("h2",{id:"\u56de\u8c03\u51fd\u6570"},"\u56de\u8c03\u51fd\u6570"),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("strong",{parentName:"p"},"\u8b66\u544a")),Object(i.b)("p",{parentName:"blockquote"},"\u672c\u7ae0\u8282\u5185\u5bb9\u76ee\u524d\u8fd8\u5904\u5728\u5b9e\u9a8c\u9636\u6bb5\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd8\u5e76\u6ca1\u6709\u592a\u591a\u7684\u5b9e\u8df5\u7ecf\u9a8c\u6765\u5904\u7406\u56de\u8c03\u51fd\u6570\u3002")),Object(i.b)("p",null,"\u539f\u751f\u6a21\u5757\u8fd8\u652f\u6301\u4e00\u79cd\u7279\u6b8a\u7684\u53c2\u6570\u2014\u2014\u56de\u8c03\u51fd\u6570\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u51fd\u6570\u6765\u628a\u8fd4\u56de\u503c\u4f20\u56de\u7ed9 JavaScript\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"RCT_EXPORT_METHOD(findEvents:(RCTResponseSenderBlock)callback)\n{\n  NSArray *events = ...\n  callback(@[[NSNull null], events]);\n}\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"RCTResponseSenderBlock"),"\u53ea\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\u2014\u2014\u4f20\u9012\u7ed9 JavaScript \u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570\u6570\u7ec4\u3002\u5728\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u91cc\u6211\u4eec\u7528 Node.js \u7684\u5e38\u7528\u4e60\u60ef\uff1a\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u9519\u8bef\u5bf9\u8c61\uff08\u6ca1\u6709\u53d1\u751f\u9519\u8bef\u7684\u65f6\u5019\u4e3a null\uff09\uff0c\u800c\u5269\u4e0b\u7684\u90e8\u5206\u662f\u51fd\u6570\u7684\u8fd4\u56de\u503c\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"CalendarManager.findEvents((error, events) => {\n  if (error) {\n    console.error(error);\n  } else {\n    this.setState({ events: events });\n  }\n});\n")),Object(i.b)("p",null,"\u539f\u751f\u6a21\u5757\u901a\u5e38\u53ea\u5e94\u8c03\u7528\u56de\u8c03\u51fd\u6570\u4e00\u6b21\u3002\u4f46\u662f\uff0c\u5b83\u53ef\u4ee5\u4fdd\u5b58 callback \u5e76\u5728\u5c06\u6765\u8c03\u7528\u3002\u8fd9\u5728\u5c01\u88c5\u90a3\u4e9b\u901a\u8fc7\u201c\u59d4\u6258\u51fd\u6570\u201d\u6765\u83b7\u5f97\u8fd4\u56de\u503c\u7684 iOS API \u65f6\u6700\u4e3a\u5e38\u89c1\u3002",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/master/React/Modules/RCTAlertManager.m"}),Object(i.b)("inlineCode",{parentName:"a"},"RCTAlertManager")),"\u4e2d\u5c31\u5c5e\u4e8e\u8fd9\u79cd\u60c5\u51b5\u3002"),Object(i.b)("p",null,"\u5982\u679c\u4f60\u60f3\u4f20\u9012\u4e00\u4e2a\u66f4\u63a5\u8fd1",Object(i.b)("inlineCode",{parentName:"p"},"Error"),"\u7c7b\u578b\u7684\u5bf9\u8c61\u7ed9 JavaScript\uff0c\u53ef\u4ee5\u7528",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/master/React/Base/RCTUtils.h"}),Object(i.b)("inlineCode",{parentName:"a"},"RCTUtils.h")),"\u63d0\u4f9b\u7684",Object(i.b)("inlineCode",{parentName:"p"},"RCTMakeError"),"\u51fd\u6570\u3002\u73b0\u5728\u5b83\u4ec5\u4ec5\u662f\u53d1\u9001\u4e86\u4e00\u4e2a\u548c Error \u7ed3\u6784\u4e00\u6837\u7684 dictionary \u7ed9 JavaScript\uff0c\u4f46\u6211\u4eec\u8003\u8651\u5728\u5c06\u6765\u7248\u672c\u91cc\u8ba9\u5b83\u4ea7\u751f\u4e00\u4e2a\u771f\u6b63\u7684",Object(i.b)("inlineCode",{parentName:"p"},"Error"),"\u5bf9\u8c61\u3002"),Object(i.b)("h2",{id:"promises"},"Promises"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"\u8bd1\u6ce8"),"\uff1a\u8fd9\u4e00\u90e8\u5206\u6d89\u53ca\u5230\u8f83\u65b0\u7684 js \u8bed\u6cd5\u548c\u7279\u6027\uff0c\u4e0d\u719f\u6089\u7684\u8bfb\u8005\u5efa\u8bae\u5148\u9605\u8bfb ES6 \u7684\u76f8\u5173\u4e66\u7c4d\u548c\u6587\u6863\u3002"),Object(i.b)("p",null,"\u539f\u751f\u6a21\u5757\u8fd8\u53ef\u4ee5\u4f7f\u7528 promise \u6765\u7b80\u5316\u4ee3\u7801\uff0c\u642d\u914d ES2016(ES7)\u6807\u51c6\u7684",Object(i.b)("inlineCode",{parentName:"p"},"async/await"),"\u8bed\u6cd5\u5219\u6548\u679c\u66f4\u4f73\u3002\u5982\u679c\u6865\u63a5\u539f\u751f\u65b9\u6cd5\u7684\u6700\u540e\u4e24\u4e2a\u53c2\u6570\u662f",Object(i.b)("inlineCode",{parentName:"p"},"RCTPromiseResolveBlock"),"\u548c",Object(i.b)("inlineCode",{parentName:"p"},"RCTPromiseRejectBlock"),"\uff0c\u5219\u5bf9\u5e94\u7684 JS \u65b9\u6cd5\u5c31\u4f1a\u8fd4\u56de\u4e00\u4e2a Promise \u5bf9\u8c61\u3002"),Object(i.b)("p",null,"\u6211\u4eec\u628a\u4e0a\u9762\u7684\u4ee3\u7801\u7528 promise \u6765\u4ee3\u66ff\u56de\u8c03\u8fdb\u884c\u91cd\u6784\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'RCT_REMAP_METHOD(findEvents,\n                 findEventsWithResolver:(RCTPromiseResolveBlock)resolve\n                 rejecter:(RCTPromiseRejectBlock)reject)\n{\n  NSArray *events = ...\n  if (events) {\n    resolve(events);\n  } else {\n    NSError *error = ...\n    reject(@"no_events", @"There were no events", error);\n  }\n}\n')),Object(i.b)("p",null,"\u73b0\u5728 JavaScript \u7aef\u7684\u65b9\u6cd5\u4f1a\u8fd4\u56de\u4e00\u4e2a Promise\u3002\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u5728\u4e00\u4e2a\u58f0\u660e\u4e86",Object(i.b)("inlineCode",{parentName:"p"},"async"),"\u7684\u5f02\u6b65\u51fd\u6570\u5185\u4f7f\u7528",Object(i.b)("inlineCode",{parentName:"p"},"await"),"\u5173\u952e\u5b57\u6765\u8c03\u7528\uff0c\u5e76\u7b49\u5f85\u5176\u7ed3\u679c\u8fd4\u56de\u3002\uff08\u867d\u7136\u8fd9\u6837\u5199\u7740\u770b\u8d77\u6765\u50cf\u540c\u6b65\u64cd\u4f5c\uff0c\u4f46\u5b9e\u9645\u4ecd\u7136\u662f\u5f02\u6b65\u7684\uff0c\u5e76\u4e0d\u4f1a\u963b\u585e\u6267\u884c\u6765\u7b49\u5f85\uff09\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"async function updateEvents() {\n  try {\n    const events = await CalendarManager.findEvents();\n\n    this.setState({ events });\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nupdateEvents();\n")),Object(i.b)("h2",{id:"\u591a\u7ebf\u7a0b"},"\u591a\u7ebf\u7a0b"),Object(i.b)("p",null,"\u539f\u751f\u6a21\u5757\u4e0d\u5e94\u5bf9\u81ea\u5df1\u88ab\u8c03\u7528\u65f6\u6240\u5904\u7684\u7ebf\u7a0b\u505a\u4efb\u4f55\u5047\u8bbe\u3002React Native \u5728\u4e00\u4e2a\u72ec\u7acb\u7684\u4e32\u884c GCD \u961f\u5217\u4e2d\u8c03\u7528\u539f\u751f\u6a21\u5757\u7684\u65b9\u6cd5\uff0c\u4f46\u8fd9\u5c5e\u4e8e\u5b9e\u73b0\u7684\u7ec6\u8282\uff0c\u5e76\u4e14\u53ef\u80fd\u4f1a\u5728\u5c06\u6765\u7684\u7248\u672c\u4e2d\u6539\u53d8\u3002\u901a\u8fc7\u5b9e\u73b0\u65b9\u6cd5",Object(i.b)("inlineCode",{parentName:"p"},"- (dispatch_queue_t)methodQueue"),"\uff0c\u539f\u751f\u6a21\u5757\u53ef\u4ee5\u6307\u5b9a\u81ea\u5df1\u60f3\u5728\u54ea\u4e2a\u961f\u5217\u4e2d\u88ab\u6267\u884c\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5982\u679c\u6a21\u5757\u9700\u8981\u8c03\u7528\u4e00\u4e9b\u5fc5\u987b\u5728\u4e3b\u7ebf\u7a0b\u624d\u80fd\u4f7f\u7528\u7684 API\uff0c\u90a3\u5e94\u5f53\u8fd9\u6837\u6307\u5b9a\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"- (dispatch_queue_t)methodQueue\n{\n  return dispatch_get_main_queue();\n}\n")),Object(i.b)("p",null,"\u7c7b\u4f3c\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u9700\u8981\u82b1\u8d39\u5f88\u957f\u65f6\u95f4\uff0c\u539f\u751f\u6a21\u5757\u4e0d\u5e94\u8be5\u963b\u585e\u4f4f\uff0c\u800c\u662f\u5e94\u5f53\u58f0\u660e\u4e00\u4e2a\u7528\u4e8e\u6267\u884c\u64cd\u4f5c\u7684\u72ec\u7acb\u961f\u5217\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c",Object(i.b)("inlineCode",{parentName:"p"},"RCTAsyncLocalStorage"),"\u6a21\u5757\u521b\u5efa\u4e86\u81ea\u5df1\u7684\u4e00\u4e2a queue\uff0c\u8fd9\u6837\u5b83\u5728\u505a\u4e00\u4e9b\u8f83\u6162\u7684\u78c1\u76d8\u64cd\u4f5c\u7684\u65f6\u5019\u5c31\u4e0d\u4f1a\u963b\u585e\u4f4f React \u672c\u8eab\u7684\u6d88\u606f\u961f\u5217\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'- (dispatch_queue_t)methodQueue\n{\n  return dispatch_queue_create("com.facebook.React.AsyncLocalStorageQueue", DISPATCH_QUEUE_SERIAL);\n}\n')),Object(i.b)("p",null,"\u6307\u5b9a\u7684",Object(i.b)("inlineCode",{parentName:"p"},"methodQueue"),"\u4f1a\u88ab\u4f60\u6a21\u5757\u91cc\u7684\u6240\u6709\u65b9\u6cd5\u5171\u4eab\u3002\u5982\u679c\u4f60\u7684\u65b9\u6cd5\u4e2d\u201c\u53ea\u6709\u4e00\u4e2a\u201d\u662f\u8017\u65f6\u8f83\u957f\u7684\uff08\u6216\u8005\u662f\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5fc5\u987b\u5728\u4e0d\u540c\u7684\u961f\u5217\u4e2d\u8fd0\u884c\u7684\uff09\uff0c\u4f60\u53ef\u4ee5\u5728\u51fd\u6570\u4f53\u5185\u7528",Object(i.b)("inlineCode",{parentName:"p"},"dispatch_async"),"\u65b9\u6cd5\u6765\u5728\u53e6\u4e00\u4e2a\u961f\u5217\u6267\u884c\uff0c\u800c\u4e0d\u5f71\u54cd\u5176\u4ed6\u65b9\u6cd5\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"RCT_EXPORT_METHOD(doSomethingExpensive:(NSString *)param callback:(RCTResponseSenderBlock)callback)\n{\n  dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n    // \u5728\u8fd9\u91cc\u6267\u884c\u957f\u65f6\u95f4\u7684\u64cd\u4f5c\n    ...\n    // \u4f60\u53ef\u4ee5\u5728\u4efb\u4f55\u7ebf\u7a0b/\u961f\u5217\u4e2d\u6267\u884c\u56de\u8c03\u51fd\u6570\n    callback(@[...]);\n  });\n}\n")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("strong",{parentName:"p"},"\u6ce8\u610f"),": \u5728\u6a21\u5757\u4e4b\u95f4\u5171\u4eab\u5206\u53d1\u961f\u5217"),Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("inlineCode",{parentName:"p"},"methodQueue"),"\u65b9\u6cd5\u4f1a\u5728\u6a21\u5757\u88ab\u521d\u59cb\u5316\u7684\u65f6\u5019\u88ab\u6267\u884c\u4e00\u6b21\uff0c\u7136\u540e\u4f1a\u88ab React Native \u7684\u6865\u63a5\u673a\u5236\u4fdd\u5b58\u4e0b\u6765\uff0c\u6240\u4ee5\u4f60\u4e0d\u9700\u8981\u81ea\u5df1\u4fdd\u5b58\u961f\u5217\u7684\u5f15\u7528\uff0c\u9664\u975e\u4f60\u5e0c\u671b\u5728\u6a21\u5757\u7684\u5176\u5b83\u5730\u65b9\u4f7f\u7528\u5b83\u3002\u4f46\u662f\uff0c\u5982\u679c\u4f60\u5e0c\u671b\u5728\u82e5\u5e72\u4e2a\u6a21\u5757\u4e2d\u5171\u4eab\u540c\u4e00\u4e2a\u961f\u5217\uff0c\u5219\u9700\u8981\u81ea\u5df1\u4fdd\u5b58\u5e76\u8fd4\u56de\u76f8\u540c\u7684\u961f\u5217\u5b9e\u4f8b\uff1b\u4ec5\u4ec5\u662f\u8fd4\u56de\u76f8\u540c\u540d\u5b57\u7684\u961f\u5217\u662f\u4e0d\u884c\u7684\u3002")),Object(i.b)("h2",{id:"\u4f9d\u8d56\u6ce8\u5165"},"\u4f9d\u8d56\u6ce8\u5165"),Object(i.b)("p",null,"bridge \u4f1a\u81ea\u52a8\u6ce8\u518c\u5b9e\u73b0\u4e86",Object(i.b)("inlineCode",{parentName:"p"},"RCTBridgeModule"),"\u534f\u8bae\u7684\u6a21\u5757\uff0c\u4f46\u662f\u4f60\u53ef\u80fd\u4e5f\u5e0c\u671b\u80fd\u591f\u81ea\u5df1\u53bb\u521d\u59cb\u5316\u81ea\u5b9a\u4e49\u7684\u6a21\u5757\u5b9e\u4f8b\uff08\u8fd9\u6837\u53ef\u4ee5\u6ce8\u5165\u4f9d\u8d56\uff09\u3002"),Object(i.b)("p",null,"\u8981\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\uff0c\u4f60\u9700\u8981\u5b9e\u73b0",Object(i.b)("inlineCode",{parentName:"p"},"RCTBridgeDelegate"),"\u534f\u8bae\uff0c\u521d\u59cb\u5316",Object(i.b)("inlineCode",{parentName:"p"},"RCTBridge"),"\uff0c\u5e76\u4e14\u5728\u521d\u59cb\u5316\u65b9\u6cd5\u91cc\u6307\u5b9a\u4ee3\u7406\u3002\u7136\u540e\u7528\u521d\u59cb\u5316\u597d\u7684",Object(i.b)("inlineCode",{parentName:"p"},"RCTBridge"),"\u5b9e\u4f8b\u521d\u59cb\u5316\u4e00\u4e2a",Object(i.b)("inlineCode",{parentName:"p"},"RCTRootView"),"\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"id<RCTBridgeDelegate> moduleInitialiser = [[classThatImplementsRCTBridgeDelegate alloc] init];\n\nRCTBridge *bridge = [[RCTBridge alloc] initWithDelegate:moduleInitialiser launchOptions:nil];\n\nRCTRootView *rootView = [[RCTRootView alloc]\n                        initWithBridge:bridge\n                            moduleName:kModuleName\n                     initialProperties:nil];\n")),Object(i.b)("h2",{id:"\u5bfc\u51fa\u5e38\u91cf"},"\u5bfc\u51fa\u5e38\u91cf"),Object(i.b)("p",null,"\u539f\u751f\u6a21\u5757\u53ef\u4ee5\u5bfc\u51fa\u4e00\u4e9b\u5e38\u91cf\uff0c\u8fd9\u4e9b\u5e38\u91cf\u5728 JavaScript \u7aef\u968f\u65f6\u90fd\u53ef\u4ee5\u8bbf\u95ee\u3002\u7528\u8fd9\u79cd\u65b9\u6cd5\u6765\u4f20\u9012\u4e00\u4e9b\u9759\u6001\u6570\u636e\uff0c\u53ef\u4ee5\u907f\u514d\u901a\u8fc7 bridge \u8fdb\u884c\u4e00\u6b21\u6765\u56de\u4ea4\u4e92\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'- (NSDictionary *)constantsToExport\n{\n  return @{ @"firstDayOfTheWeek": @"Monday" };\n}\n')),Object(i.b)("p",null,"JavaScript \u7aef\u53ef\u4ee5\u968f\u65f6\u540c\u6b65\u5730\u8bbf\u95ee\u8fd9\u4e2a\u6570\u636e\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"console.log(CalendarManager.firstDayOfTheWeek);\n")),Object(i.b)("p",null,"\u4f46\u662f\u6ce8\u610f\u8fd9\u4e2a\u5e38\u91cf\u4ec5\u4ec5\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u5bfc\u51fa\u4e86\u4e00\u6b21\uff0c\u6240\u4ee5\u5373\u4f7f\u4f60\u5728\u8fd0\u884c\u671f\u95f4\u6539\u53d8",Object(i.b)("inlineCode",{parentName:"p"},"constantToExport"),"\u8fd4\u56de\u7684\u503c\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5230 JavaScript \u73af\u5883\u4e0b\u6240\u5f97\u5230\u7684\u7ed3\u679c\u3002"),Object(i.b)("h3",{id:"\u5b9e\u73b0--requiresmainqueuesetup"},"\u5b9e\u73b0 ",Object(i.b)("inlineCode",{parentName:"h3"},"+ requiresMainQueueSetup")),Object(i.b)("p",null,"If you override ",Object(i.b)("inlineCode",{parentName:"p"},"- constantsToExport")," then you should also implement ",Object(i.b)("inlineCode",{parentName:"p"},"+ requiresMainQueueSetup")," to let React Native know if your module needs to be initialized on the main thread. Otherwise you will see a warning that in the future your module may be initialized on a background thread unless you explicitly opt out with ",Object(i.b)("inlineCode",{parentName:"p"},"+ requiresMainQueueSetup"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"+ (BOOL)requiresMainQueueSetup\n{\n  return YES;  // only do this if your module initialization relies on calling UIKit!\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-Swift"}),'// Swift\n// CalendarManager.swift\n@objc(CalendarManager)\nclass CalendarManager: NSObject, RCTBridgeModule {\nstatic func moduleName() -> String! {\n      return "CalendarManager";\n}\nstatic func requiresMainQueueSetup() -> Bool {\n    return true\n}\n\nIf your module does not require access to UIKit, then you should respond to `+ requiresMainQueueSetup` with `NO`.\n\n### \u679a\u4e3e\u5e38\u91cf\n\n\u7528`NS_ENUM`\u5b9a\u4e49\u7684\u679a\u4e3e\u7c7b\u578b\u5fc5\u987b\u8981\u5148\u6269\u5c55\u5bf9\u5e94\u7684 RCTConvert \u65b9\u6cd5\u624d\u53ef\u4ee5\u4f5c\u4e3a\u51fd\u6570\u53c2\u6570\u4f20\u9012\u3002\n\n\u5047\u8bbe\u6211\u4eec\u8981\u5bfc\u51fa\u5982\u4e0b\u7684`NS_ENUM`\u5b9a\u4e49\uff1a\n\n```objectivec\ntypedef NS_ENUM(NSInteger, UIStatusBarAnimation) {\n    UIStatusBarAnimationNone,\n    UIStatusBarAnimationFade,\n    UIStatusBarAnimationSlide,\n};\n')),Object(i.b)("p",null,"\u4f60\u9700\u8981\u8fd9\u6837\u6765\u6269\u5c55 RCTConvert \u7c7b\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'@implementation RCTConvert (StatusBarAnimation)\n  RCT_ENUM_CONVERTER(UIStatusBarAnimation, (@{ @"statusBarAnimationNone" : @(UIStatusBarAnimationNone),\n                                               @"statusBarAnimationFade" : @(UIStatusBarAnimationFade),\n                                               @"statusBarAnimationSlide" : @(UIStatusBarAnimationSlide)}),\n                      UIStatusBarAnimationNone, integerValue)\n@end\n')),Object(i.b)("p",null,"\u63a5\u7740\u4f60\u53ef\u4ee5\u8fd9\u6837\u5b9a\u4e49\u65b9\u6cd5\u5e76\u4e14\u5bfc\u51fa enum \u503c\u4f5c\u4e3a\u5e38\u91cf\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'- (NSDictionary *)constantsToExport\n{\n  return @{ @"statusBarAnimationNone" : @(UIStatusBarAnimationNone),\n            @"statusBarAnimationFade" : @(UIStatusBarAnimationFade),\n            @"statusBarAnimationSlide" : @(UIStatusBarAnimationSlide) };\n};\n\nRCT_EXPORT_METHOD(updateStatusBarAnimation:(UIStatusBarAnimation)animation\n                                completion:(RCTResponseSenderBlock)callback)\n')),Object(i.b)("p",null,"\u4f60\u7684\u679a\u4e3e\u73b0\u5728\u4f1a\u7528\u4e0a\u9762\u63d0\u4f9b\u7684\u9009\u62e9\u5668\u8fdb\u884c\u8f6c\u6362\uff08\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u662f",Object(i.b)("inlineCode",{parentName:"p"},"integerValue"),"\uff09\uff0c\u7136\u540e\u518d\u4f20\u9012\u7ed9\u4f60\u5bfc\u51fa\u7684\u51fd\u6570\u3002"),Object(i.b)("h2",{id:"\u7ed9-javascript-\u7aef\u53d1\u9001\u4e8b\u4ef6"},"\u7ed9 JavaScript \u7aef\u53d1\u9001\u4e8b\u4ef6"),Object(i.b)("p",null,"\u5373\u4f7f\u6ca1\u6709\u88ab JavaScript \u8c03\u7528\uff0c\u539f\u751f\u6a21\u5757\u4e5f\u53ef\u4ee5\u7ed9 JavaScript \u53d1\u9001\u4e8b\u4ef6\u901a\u77e5\u3002\u6700\u597d\u7684\u65b9\u6cd5\u662f\u7ee7\u627f",Object(i.b)("inlineCode",{parentName:"p"},"RCTEventEmitter"),"\uff0c\u5b9e\u73b0",Object(i.b)("inlineCode",{parentName:"p"},"suppportEvents"),"\u65b9\u6cd5\u5e76\u8c03\u7528",Object(i.b)("inlineCode",{parentName:"p"},"self sendEventWithName:"),"\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"// CalendarManager.h\n#import <React/RCTBridgeModule.h>\n#import <React/RCTEventEmitter.h>\n\n@interface CalendarManager : RCTEventEmitter <RCTBridgeModule>\n\n@end\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'// CalendarManager.m\n#import "CalendarManager.h"\n\n@implementation CalendarManager\n\nRCT_EXPORT_MODULE();\n\n- (NSArray<NSString *> *)supportedEvents\n{\n  return @[@"EventReminder"];\n}\n\n- (void)calendarEventReminderReceived:(NSNotification *)notification\n{\n  NSString *eventName = notification.userInfo[@"name"];\n  [self sendEventWithName:@"EventReminder" body:@{@"name": eventName}];\n}\n\n@end\n')),Object(i.b)("p",null,"JavaScript \u7aef\u7684\u4ee3\u7801\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4f60\u7684\u6a21\u5757\u7684",Object(i.b)("inlineCode",{parentName:"p"},"NativeEventEmitter"),"\u5b9e\u4f8b\u6765\u8ba2\u9605\u8fd9\u4e9b\u4e8b\u4ef6\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"import { NativeEventEmitter, NativeModules } from 'react-native';\nconst { CalendarManager } = NativeModules;\n\nconst calendarManagerEmitter = new NativeEventEmitter(CalendarManager);\n\nconst subscription = calendarManagerEmitter.addListener(\n  'EventReminder',\n  (reminder) => console.log(reminder.name)\n);\n...\n// \u522b\u5fd8\u4e86\u53d6\u6d88\u8ba2\u9605\uff0c\u901a\u5e38\u5728componentWillUnmount\u751f\u547d\u5468\u671f\u65b9\u6cd5\u4e2d\u5b9e\u73b0\u3002\nsubscription.remove();\n")),Object(i.b)("h3",{id:"\u4f18\u5316\u65e0\u76d1\u542c\u5904\u7406\u7684\u4e8b\u4ef6"},"\u4f18\u5316\u65e0\u76d1\u542c\u5904\u7406\u7684\u4e8b\u4ef6"),Object(i.b)("p",null,"\u5982\u679c\u4f60\u53d1\u9001\u4e86\u4e00\u4e2a\u4e8b\u4ef6\u5374\u6ca1\u6709\u4efb\u4f55\u76d1\u542c\u5904\u7406\uff0c\u5219\u4f1a\u56e0\u6b64\u6536\u5230\u4e00\u4e2a\u8d44\u6e90\u8b66\u544a\u3002\u8981\u4f18\u5316\u56e0\u6b64\u5e26\u6765\u7684\u989d\u5916\u5f00\u9500\uff0c\u4f60\u53ef\u4ee5\u5728\u4f60\u7684",Object(i.b)("inlineCode",{parentName:"p"},"RCTEventEmitter"),"\u5b50\u7c7b\u4e2d\u8986\u76d6",Object(i.b)("inlineCode",{parentName:"p"},"startObserving"),"\u548c",Object(i.b)("inlineCode",{parentName:"p"},"stopObserving"),"\u65b9\u6cd5\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),'@implementation CalendarManager\n{\n  bool hasListeners;\n}\n\n// \u5728\u6dfb\u52a0\u7b2c\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u65f6\u89e6\u53d1\n-(void)startObserving {\n    hasListeners = YES;\n    // Set up any upstream listeners or background tasks as necessary\n}\n\n// Will be called when this module\'s last listener is removed, or on dealloc.\n-(void)stopObserving {\n    hasListeners = NO;\n    // Remove upstream listeners, stop unnecessary background tasks\n}\n\n- (void)calendarEventReminderReceived:(NSNotification *)notification\n{\n  NSString *eventName = notification.userInfo[@"name"];\n  if (hasListeners) { // Only send events if anyone is listening\n    [self sendEventWithName:@"EventReminder" body:@{@"name": eventName}];\n  }\n}\n')),Object(i.b)("h2",{id:"\u4ece-swift-\u5bfc\u51fa"},"\u4ece Swift \u5bfc\u51fa"),Object(i.b)("p",null,"Swift \u4e0d\u652f\u6301\u5b8f\uff0c\u6240\u4ee5\u4ece Swift \u5411 React Native \u5bfc\u51fa\u7c7b\u548c\u51fd\u6570\u9700\u8981\u591a\u505a\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u4f46\u662f\u5927\u81f4\u4e0e Objective-C \u662f\u76f8\u540c\u7684\u3002"),Object(i.b)("p",null,"\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u4e00\u4e2a\u4e00\u6837\u7684",Object(i.b)("inlineCode",{parentName:"p"},"CalendarManager"),"\uff0c\u4e0d\u8fc7\u662f\u7528 Swift \u5b9e\u73b0\u7684\u7c7b:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift"}),'// CalendarManager.swift\n\n@objc(CalendarManager)\nclass CalendarManager: NSObject {\n\n  @objc(addEvent:location:date:)\n  func addEvent(name: String, location: String, date: NSNumber) -> Void {\n    // Date is ready to use!\n  }\n\n  @objc\n  func constantsToExport() -> [String: Any]! {\n    return ["someKey": "someValue"]\n  }\n\n}\n')),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("strong",{parentName:"p"},"\u6ce8\u610f"),": \u4f60\u5fc5\u987b\u4f7f\u7528@objc \u6807\u8bb0\u6765\u786e\u4fdd\u7c7b\u548c\u51fd\u6570\u5bf9 Objective-C \u516c\u5f00\u3002")),Object(i.b)("p",null,"\u63a5\u7740\uff0c\u521b\u5efa\u4e00\u4e2a\u79c1\u6709\u7684\u5b9e\u73b0\u6587\u4ef6\uff0c\u5e76\u5c06\u5fc5\u8981\u7684\u4fe1\u606f\u6ce8\u518c\u5230 React Native \u4e2d\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"// CalendarManagerBridge.m\n#import <React/RCTBridgeModule.h>\n\n@interface RCT_EXTERN_MODULE(CalendarManager, NSObject)\n\nRCT_EXTERN_METHOD(addEvent:(NSString *)name location:(NSString *)location date:(nonnull NSNumber *)date)\n\n@end\n")),Object(i.b)("p",null,"\u8bf7\u6ce8\u610f\uff0c\u4e00\u65e6\u4f60",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://developer.apple.com/library/prerelease/ios/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html"}),"\u5728 IOS \u4e2d\u6df7\u7528 2 \u79cd\u8bed\u8a00"),", \u90a3\u5c31\u8fd8\u9700\u8981\u4e00\u4e2a\u989d\u5916\u7684\u6865\u63a5\u5934\u6587\u4ef6\uff0c\u79f0\u4f5c\u201cbridging header\u201d\uff0c\u7528\u6765\u5bfc\u51fa Objective-C \u6587\u4ef6\u7ed9 Swift\u3002\u5982\u679c\u4f60\u662f\u901a\u8fc7 Xcode \u83dc\u5355\u4e2d\u7684",Object(i.b)("inlineCode",{parentName:"p"},"File>New File"),"\u6765\u521b\u5efa\u7684 Swift \u6587\u4ef6\uff0cXcode \u4f1a\u81ea\u52a8\u4e3a\u4f60\u521b\u5efa\u8fd9\u4e2a\u5934\u6587\u4ef6\u3002\u5728\u8fd9\u4e2a\u5934\u6587\u4ef6\u4e2d\uff0c\u4f60\u9700\u8981\u5f15\u5165",Object(i.b)("inlineCode",{parentName:"p"},"RCTBridgeModule.h"),"\u3002"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-objectivec"}),"// CalendarManager-Bridging-Header.h\n#import <React/RCTBridgeModule.h>\n")),Object(i.b)("p",null,"\u540c\u6837\u7684\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528",Object(i.b)("inlineCode",{parentName:"p"},"RCT_EXTERN_REMAP_MODULE"),"\u548c",Object(i.b)("inlineCode",{parentName:"p"},"RCT_EXTERN_REMAP_METHOD"),"\u6765\u6539\u53d8\u5bfc\u51fa\u6a21\u5757\u548c\u65b9\u6cd5\u7684 JavaScript \u8c03\u7528\u540d\u79f0\u3002\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/master/React/Base/RCTBridgeModule.h"}),Object(i.b)("inlineCode",{parentName:"a"},"RCTBridgeModule")),"."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("strong",{parentName:"p"},"Important when making third party modules"),": Static libraries with Swift are only supported in Xcode 9 and later. In order for the Xcode project to build when you use Swift in the iOS static library you include in the module, your main app project must contain Swift code and a bridging header itself. If your app project does not contain any Swift code, a workaround can be a single empty .swift file and an empty bridging header.")),Object(i.b)("h2",{id:"reserved-method-names"},"Reserved Method Names"),Object(i.b)("h3",{id:"invalidate"},"invalidate()"),Object(i.b)("p",null,"Native modules can conform to the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/aa0ef15335fe27c0c193e3e968789886d82e82ed/React/Base/RCTInvalidating.h"}),"RCTInvalidating")," protocol on iOS by implementing the ",Object(i.b)("inlineCode",{parentName:"p"},"invalidate")," method. This method ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/18e3303cd46a72668caae46e28c7c6ae69fbf8f8/ReactCommon/turbomodule/core/platform/ios/RCTTurboModuleManager.mm#L456"}),"can be invoked")," when the native bridge is invalidated (ie: on devmode reload). You should avoid implementing this method in general, as this mechanism exists for backwards compatibility and may be removed in the future."))}p.isMDXComponent=!0},413:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return m}));var a=t(0),r=t.n(a);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var b=r.a.createContext({}),p=function(e){var n=r.a.useContext(b),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=p(e.components);return r.a.createElement(b.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},u=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),d=p(t),u=a,m=d["".concat(c,".").concat(u)]||d[u]||s[u]||i;return t?r.a.createElement(m,o(o({ref:n},b),{},{components:t})):r.a.createElement(m,o({ref:n},b))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,c=new Array(i);c[0]=u;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,c[1]=o;for(var b=2;b<i;b++)c[b]=t[b];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);