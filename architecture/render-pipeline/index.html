<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-architecture docs-doc-id-render-pipeline">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-63485149-4","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-63485149-4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-63485149-4",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="React Native ä¸­æ–‡ç½‘" href="/opensearch.xml">
<script src="//snack.expo.dev/embed.js" defer="defer"></script>
<script src="//cdn.wwads.cn/js/makemoney.js" defer="defer"></script><title data-rh="true">Render, Commit, and Mount Â· React Native ä¸­æ–‡ç½‘</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:image" content="https://reactnative.cn/img/logo-og.png"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:url" content="https://reactnative.cn"><meta data-rh="true" property="og:image" content="img/logo-og.png"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-architecture-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-architecture-current"><meta data-rh="true" property="og:title" content="Render, Commit, and Mount Â· React Native ä¸­æ–‡ç½‘"><meta data-rh="true" name="description" content="The React Native renderer goes through a sequence of work to render React logic to a host platform. This sequence of work is called the render pipeline and occurs for initial renders and updates to the UI state. This document goes over the render pipeline and how it differs in those scenarios."><meta data-rh="true" property="og:description" content="The React Native renderer goes through a sequence of work to render React logic to a host platform. This sequence of work is called the render pipeline and occurs for initial renders and updates to the UI state. This document goes over the render pipeline and how it differs in those scenarios."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://reactnative.cn/architecture/render-pipeline"><link data-rh="true" rel="alternate" href="https://reactnative.cn/architecture/render-pipeline" hreflang="en"><link data-rh="true" rel="alternate" href="https://reactnative.cn/architecture/render-pipeline" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GJGDC5L5HP-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7e4b770f.css">
<link rel="preload" href="/assets/js/runtime~main.b02afa69.js" as="script">
<link rel="preload" href="/assets/js/main.3b25dbd5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_BxGa">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/header_logo.svg" alt="React Native ä¸­æ–‡ç½‘" class="themedImage_aIr_ themedImage--light_DGIu"><img src="/img/header_logo.svg" alt="React Native ä¸­æ–‡ç½‘" class="themedImage_aIr_ themedImage--dark_RoHN"></div><b class="navbar__title">React Native ä¸­æ–‡ç½‘</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/getting-started">æ–‡æ¡£</a><a class="navbar__item navbar__link" href="/docs/components-and-apis">ç»„ä»¶</a><a class="navbar__item navbar__link" href="/docs/accessibilityinfo">API</a><a class="navbar__item navbar__link navbar__link--active" href="/architecture/overview">æ¶æ„</a><a href="//time.geekbang.org/column/intro/100110101?code=FAqHFVRUur%2FgAP-yJQWitk9ieF80imRky3PVsIs%2FX6A%3D" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link hot-link">å®æˆ˜è¯¾<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GWqj"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="//github.com/reactnativecn/react-native-website/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">è®¨è®º<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GWqj"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="//pushy.reactnative.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link hot-link">çƒ­æ›´æ–°<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GWqj"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/about">å…³äº</a><a href="//github.com/facebook/react-native" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-github-link" aria-label="GitHub repository"></a><div class="toggle_IT2h colorModeToggle_o_qc"><button class="clean-btn toggleButton_pGki toggleButtonDisabled_vZLo" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dYsV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_WRF1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_lGmL"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_zNSk"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_ecpa" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_NEdF"><div class="sidebar_Uz2u"><nav class="menu thin-scrollbar menu_XU2j"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/architecture/overview">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/overview">Architecture Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist-caret menu__link--active" tabindex="0">Rendering</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/fabric-renderer">Fabric</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/architecture/render-pipeline">Render, Commit, and Mount</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/xplat-implementation">Cross Platform Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/view-flattening">View Flattening</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/threading-model">Threading Model</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/glossary">Glossary</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_vJqy"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_nDMA"><div class="docItemContainer_p3Qu"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_nmcO" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">ğŸ </a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Architecture</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Rendering</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Render, Commit, and Mount</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_aX8Q theme-doc-toc-mobile tocMobile_diN6"><button type="button" class="clean-btn tocCollapsibleButton_Va7b">On this page</button></div><a href="https://time.geekbang.org/column/intro/100110101?code=FAqHFVRUur%2FgAP-yJQWitk9ieF80imRky3PVsIs%2FX6A%3D" target="_blank" style="display:block;padding:12px;background-color:#eee;color:#666;margin-bottom:15px"><span style="font-weight:bold;color:#05a5d1">æ–°æ¶æ„å®æˆ˜è¯¾</span> <!-- -->å®æ“ + åŸºå»º + åŸç†å…¨ç»´åº¦åŒ…æ½ï¼ŒæŠ¢å…ˆæŒæ¡ React Native æ–°æ¶æ„ç²¾é«“<!-- --> <span style="border:solid 1px #666;padding:4px 6px;margin-left:8px;vertical-align:middle">ç«‹å³æŸ¥çœ‹ &gt;</span></a><div class="theme-doc-markdown markdown"><header><h1>Render, Commit, and Mount</h1></header><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>This document refers to the architecture of the new renderer, <a href="/architecture/fabric-renderer">Fabric</a>, that is in active roll-out.</p></div></div><p>The React Native renderer goes through a sequence of work to render React logic to a <a href="/architecture/glossary#host-platform">host platform</a>. This sequence of work is called the render pipeline and occurs for initial renders and updates to the UI state. This document goes over the render pipeline and how it differs in those scenarios.</p><p>The render pipeline can be broken into three general phases:</p><ol><li><strong>Render:</strong> React executes product logic which creates a <a href="/architecture/glossary#react-element-tree-and-react-element">React Element Trees</a> in JavaScript. From this tree, the renderer creates a <a href="/architecture/glossary#react-shadow-tree-and-react-shadow-node">React Shadow Tree</a> in C++.</li><li><strong>Commit</strong>: After a React Shadow Tree is fully created, the renderer triggers a commit. This <strong>promotes</strong> both the React Element Tree and the newly created React Shadow Tree as the â€œnext treeâ€ to be mounted. This also schedules calculation of its layout information.</li><li><strong>Mount:</strong> The React Shadow Tree, now with the results of layout calculation, is transformed into a <a href="/architecture/glossary#host-view-tree-and-host-view">Host View Tree</a>.</li></ol><blockquote><p>The phases of the render pipeline may occur on different threads. Refer to the <a href="/architecture/threading-model">Threading Model</a> doc for more detail.</p></blockquote><p><img loading="lazy" alt="React Native renderer Data flow" src="/assets/images/data-flow-17cc787288df187badd01e1ff17d2833.jpg" width="1316" height="1286" class="img_PFMr"></p><hr><h2 class="anchor anchorWithStickyNavbar_YDjN" id="initial-render">Initial Render<a class="hash-link" href="#initial-render" title="Direct link to heading">â€‹</a></h2><p>Imagine you want to render the following:</p><div class="codeBlockContainer_CBWl language-jsx theme-code-block"><div class="codeBlockContent_vhl8" style="color:#FFFFFF;background:#282C34"><pre tabindex="0" class="prism-code language-jsx codeBlock_w2AC thin-scrollbar"><code class="codeBlockLines_OfWd"><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">MyComponent</span><span class="token punctuation" style="color:#657b83">(</span><span class="token punctuation" style="color:#657b83">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#657b83">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#657b83">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">Text</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain-text">Hello, World</span><span class="token tag punctuation" style="color:#657b83">&lt;/</span><span class="token tag class-name" style="color:#fac863">Text</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#657b83">&lt;/</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain">  </span><span class="token punctuation" style="color:#657b83">)</span><span class="token punctuation" style="color:#657b83">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain"></span><span class="token punctuation" style="color:#657b83">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain"></span><span class="token comment" style="color:#93a1a1">// &lt;MyComponent /&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_R7VQ clean-btn"><span class="copyButtonIcons_Uqyx" aria-hidden="true"><svg class="copyButtonIcon_CtfL" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Mq1p" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>In the example above, <code>&lt;MyComponent /&gt;</code> is a <a href="/architecture/glossary#react-element-tree-and-react-element">React Element</a>. React recursively reduces this <em>React Element</em> to a terminal <a href="/architecture/glossary#react-host-components-or-host-components">React Host Component</a> by invoking it (or its <code>render</code> method if implemented with a JavaScript class) until every <em>React Element</em> cannot be reduced any further. Now you have a <em>React Element Tree</em> of <a href="/architecture/glossary#react-host-components-or-host-components">React Host Components</a>.</p><h3 class="anchor anchorWithStickyNavbar_YDjN" id="phase-1-render">Phase 1. Render<a class="hash-link" href="#phase-1-render" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="Phase one: render" src="/assets/images/phase-one-render-cdd8336227468340a4c6b37d485e5bf8.png" width="1622" height="92" class="img_PFMr"></p><p>During this process of element reduction, as each <em>React Element</em> is invoked, the renderer also synchronously creates a <a href="/architecture/glossary#react-shadow-tree-and-react-shadow-node">React Shadow Node</a>. This happens only for <em>React Host Components</em>, not for <a href="/architecture/glossary#react-composite-components">React Composite Components</a>. In the example above, the <code>&lt;View&gt;</code> leads to the creation of a <code>ViewShadowNode</code> object, and the
<code>&lt;Text&gt;</code> leads to the creation of a <code>TextShadowNode</code> object. Notably, there is never a <em>React Shadow Node</em> that directly represents <code>&lt;MyComponent&gt;</code>.</p><p>Whenever React creates a parent-child relationship between two <em>React Element Nodes</em>, the renderer creates the same relationship between the corresponding <em>React Shadow Nodes</em>. This is how the <em>React Shadow Tree</em> is assembled.</p><p><strong>Additional Details</strong></p><ul><li>The operations (creation of <em>React Shadow Node</em>, creation of parent-child relationship between two <em>React Shadow Nodes</em>) are synchronous and thread-safe operations that are executed from React (JavaScript) into the renderer (C++), usually on the JavaScript thread.</li><li>The <em>React Element Tree</em> (and its constituent <em>React Element Nodes</em>) do not exist indefinitely. It is a temporal representation materialized by â€œfibersâ€ in React. Each â€œfiberâ€ that represents a host component stores a C++ pointer to the <em>React Shadow Node</em>, made possible by JSI. <a href="https://github.com/acdlite/react-fiber-architecture#what-is-a-fiber" target="_blank" rel="noopener noreferrer">Learn more about â€œfibersâ€ in this document.</a></li><li>The <em>React Shadow Tree</em> is immutable. In order to update any <em>React Shadow Node</em>, the renderer creates a new <em>React Shadow Tree</em>. However, the renderer provides cloning operations to make state updates more performant (see <a href="/architecture/render-pipeline#react-state-updates">React State Updates</a> for more details).</li></ul><p>In the example above, the result of the render phase looks like this:</p><p><img loading="lazy" alt="Step one" src="/assets/images/render-pipeline-1-e5243e792e2cd1a55617acb26adbcf2b.png" width="2121" height="1023" class="img_PFMr"></p><p>After the <em>React Shadow Tree</em> is complete, the renderer triggers a commit of the <em>React Element Tree</em>.</p><h3 class="anchor anchorWithStickyNavbar_YDjN" id="phase-2-commit">Phase 2. Commit<a class="hash-link" href="#phase-2-commit" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="Phase two: commit" src="/assets/images/phase-two-commit-bc6267e2319ae0ccfaa52663d36ad48f.png" width="1622" height="92" class="img_PFMr"></p><p>The commit phase consists of two operations: <em>Layout Calculation</em> and <em>Tree Promotion</em>.</p><ul><li><strong>Layout Calculation:</strong> This operation calculates the position and size of each <em>React Shadow Node</em>. In React Native, this involves invoking Yoga to calculate the layout of each <em>React Shadow Node</em>. The actual calculation requires each <em>React Shadow Node</em>â€™s styles which originate from a <em>React Element</em> in JavaScript. It also requires the layout constraints of the root of the <em>React Shadow Tree</em>, which determines the amount of available space that the resulting nodes can occupy.</li></ul><p><img loading="lazy" alt="Step two" src="/assets/images/render-pipeline-2-75ee0201996c04a64f009f1a67bf470a.png" width="2117" height="1026" class="img_PFMr"></p><ul><li><strong>Tree Promotion (New Tree â†’ Next Tree):</strong> This operation promotes the new <em>React Shadow Tree</em> as the â€œnext treeâ€ to be mounted. This promotion indicates that the new <em>React Shadow Tree</em> has all the information to be mounted and represents the latest state of the <em>React Element Tree</em>. The â€œnext treeâ€ mounts on the next â€œtickâ€ of the UI Thread.</li></ul><p><strong>Additional Details</strong></p><ul><li>These operations are asynchronously executed on a background thread.</li><li>Majority of layout calculation executes entirely within C++. However, the layout calculation of some components depend on the <em>host platform</em> (e.g. <code>Text</code>, <code>TextInput</code>, etc.). Size and position of text is specific to each <em>host platform</em> and needs to be calculated on the <em>host platform</em> layer. For this purpose, Yoga invokes a function defined in the <em>host platform</em> to calculate the componentâ€™s layout.</li></ul><h3 class="anchor anchorWithStickyNavbar_YDjN" id="phase-3-mount">Phase 3. Mount<a class="hash-link" href="#phase-3-mount" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="Phase three: mount" src="/assets/images/phase-three-mount-3544340fff87101e0f7815560061fec7.png" width="1622" height="92" class="img_PFMr"></p><p>The mount phase transforms the <em>React Shadow Tree</em> (which now contains data from layout calculation) into a <em>Host</em> <em>View Tree</em> with rendered pixels on the screen. As a reminder, the <em>React Element Tree</em> looks like this:</p><div class="codeBlockContainer_CBWl language-jsx theme-code-block"><div class="codeBlockContent_vhl8" style="color:#FFFFFF;background:#282C34"><pre tabindex="0" class="prism-code language-jsx codeBlock_w2AC thin-scrollbar"><code class="codeBlockLines_OfWd"><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">Text</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain-text">Hello, World</span><span class="token tag punctuation" style="color:#657b83">&lt;/</span><span class="token tag class-name" style="color:#fac863">Text</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#657b83">&lt;/</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_R7VQ clean-btn"><span class="copyButtonIcons_Uqyx" aria-hidden="true"><svg class="copyButtonIcon_CtfL" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Mq1p" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>At a high level, React Native renderer creates a corresponding <a href="/architecture/glossary#host-view-tree-and-host-view">Host View</a> for each <em>React Shadow Node</em> and mounts it on screen. In the example above, the renderer creates an instance of <code>android.view.ViewGroup</code> for the <code>&lt;View&gt;</code> and <code>android.widget.TextView</code> for <code>&lt;Text&gt;</code> and populates it with â€œHello Worldâ€. Similarly for iOS a <code>UIView</code> is created with and text is populated with a call to <code>NSLayoutManager</code>. Each host view is then configured to use props from its React Shadow Node, and its size and position is configured using the calculated layout information.</p><p><img loading="lazy" alt="Step two" src="/assets/images/render-pipeline-3-1dc3249f58a1ecef0392b7faabaca37c.png" width="2206" height="1066" class="img_PFMr"></p><p>In more detail, the mounting phase consists of these three steps:</p><ul><li><strong>Tree Diffing:</strong> This step computes the diff between the â€œpreviously rendered treeâ€ and the â€œnext treeâ€ entirely in C++. The result is a list of atomic mutation operations to be performed on host views (e.g. <code>createView</code>, <code>updateView</code>, <code>removeView</code>, <code>deleteView</code>, etc). This step is also where the React Shadow Tree is flattened to avoid creating unnecessary host views. See <a href="/architecture/view-flattening">View Flattening</a> for details about this algorithm.</li><li><strong>Tree Promotion (Next Tree â†’ Rendered Tree)</strong>: This step atomically promotes the â€œnext treeâ€ to â€œpreviously rendered treeâ€ so that the next mount phase computes a diff against the proper tree.</li><li><strong>View Mounting</strong>: This step applies the atomic mutation operations onto corresponding host views. This step executes in the <em>host platform</em> on UI thread.</li></ul><p><strong>Additional Details</strong></p><ul><li>The operations are synchronously executed on UI thread. If the commit phase executes on background thread, the mounting phase is scheduled for the next â€œtickâ€ of UI thread. On the other hand, if the commit phase executes on UI thread, mounting phase executes synchronously on the same thread.</li><li>Scheduling, implementation, and execution of the mounting phase heavily depends on the <em>host platform</em>. For example, the renderer architecture of the mounting layer currently differs between Android and iOS.</li><li>During the initial render, the â€œpreviously rendered treeâ€ is empty. As such, the tree diffing step will result in a list of mutation operations that consists only of creating views, setting props, and adding views to each other. Tree diffing becomes more important for performance when processing <a href="#react-state-updates">React State Updates</a>.</li><li>In current production tests, a <em>React Shadow Tree</em> typically consists of about 600-1000 <em>React Shadow Nodes</em> (before view flattening), the trees get reduced to ~200 nodes after view flattening. On iPad or desktop apps, this quantity may increase 10-fold.</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_YDjN" id="react-state-updates">React State Updates<a class="hash-link" href="#react-state-updates" title="Direct link to heading">â€‹</a></h2><p>Letâ€™s explore each phase of the render pipeline when the state of a <em>React Element Tree</em> is updated. Letâ€™s say, youâ€™ve rendered the following component in an initial render:</p><div class="codeBlockContainer_CBWl language-jsx theme-code-block"><div class="codeBlockContent_vhl8" style="color:#FFFFFF;background:#282C34"><pre tabindex="0" class="prism-code language-jsx codeBlock_w2AC thin-scrollbar"><code class="codeBlockLines_OfWd"><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">MyComponent</span><span class="token punctuation" style="color:#657b83">(</span><span class="token punctuation" style="color:#657b83">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#657b83">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#657b83">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag" style="color:#fc929e"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag" style="color:#fc929e">        </span><span class="token tag attr-name" style="color:#c5a5c5">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#657b83">=</span><span class="token tag script language-javascript punctuation" style="color:#657b83">{</span><span class="token tag script language-javascript punctuation" style="color:#657b83">{</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">backgroundColor</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript string" style="color:#8dc891">&#x27;red&#x27;</span><span class="token tag script language-javascript punctuation" style="color:#657b83">,</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">height</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript number" style="color:#5a9bcf">20</span><span class="token tag script language-javascript punctuation" style="color:#657b83">,</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">width</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript number" style="color:#5a9bcf">20</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript punctuation" style="color:#657b83">}</span><span class="token tag script language-javascript punctuation" style="color:#657b83">}</span><span class="token tag" style="color:#fc929e"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag" style="color:#fc929e">      </span><span class="token tag punctuation" style="color:#657b83">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag" style="color:#fc929e"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag" style="color:#fc929e">        </span><span class="token tag attr-name" style="color:#c5a5c5">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#657b83">=</span><span class="token tag script language-javascript punctuation" style="color:#657b83">{</span><span class="token tag script language-javascript punctuation" style="color:#657b83">{</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">backgroundColor</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript string" style="color:#8dc891">&#x27;blue&#x27;</span><span class="token tag script language-javascript punctuation" style="color:#657b83">,</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">height</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript number" style="color:#5a9bcf">20</span><span class="token tag script language-javascript punctuation" style="color:#657b83">,</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">width</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript number" style="color:#5a9bcf">20</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript punctuation" style="color:#657b83">}</span><span class="token tag script language-javascript punctuation" style="color:#657b83">}</span><span class="token tag" style="color:#fc929e"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag" style="color:#fc929e">      </span><span class="token tag punctuation" style="color:#657b83">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#657b83">&lt;/</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain">  </span><span class="token punctuation" style="color:#657b83">)</span><span class="token punctuation" style="color:#657b83">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain"></span><span class="token punctuation" style="color:#657b83">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_R7VQ clean-btn"><span class="copyButtonIcons_Uqyx" aria-hidden="true"><svg class="copyButtonIcon_CtfL" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Mq1p" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Applying what was described in the <a href="#initial-render">Initial Render</a> section, you would expect the following trees to be created:</p><p><img loading="lazy" alt="Render pipeline 4" src="/assets/images/render-pipeline-4-0f4611cfae668670f72f2b4c89813714.png" width="2005" height="838" class="img_PFMr"></p><p>Notice that <strong>Node 3</strong> maps to a host view with a <strong>red background</strong>, and <strong>Node 4</strong> maps to a host view with a <strong>blue background</strong>. Assume that as the result of a state update in JavaScript product logic, the background of the first nested <code>&lt;View&gt;</code> changes from <code>&#x27;red&#x27;</code> to <code>&#x27;yellow&#x27;</code>. This is what the new <em>React Element Tree</em> might look:</p><div class="codeBlockContainer_CBWl language-jsx theme-code-block"><div class="codeBlockContent_vhl8" style="color:#FFFFFF;background:#282C34"><pre tabindex="0" class="prism-code language-jsx codeBlock_w2AC thin-scrollbar"><code class="codeBlockLines_OfWd"><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag" style="color:#fc929e"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag" style="color:#fc929e">    </span><span class="token tag attr-name" style="color:#c5a5c5">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#657b83">=</span><span class="token tag script language-javascript punctuation" style="color:#657b83">{</span><span class="token tag script language-javascript punctuation" style="color:#657b83">{</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">backgroundColor</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript string" style="color:#8dc891">&#x27;yellow&#x27;</span><span class="token tag script language-javascript punctuation" style="color:#657b83">,</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">height</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript number" style="color:#5a9bcf">20</span><span class="token tag script language-javascript punctuation" style="color:#657b83">,</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">width</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript number" style="color:#5a9bcf">20</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript punctuation" style="color:#657b83">}</span><span class="token tag script language-javascript punctuation" style="color:#657b83">}</span><span class="token tag" style="color:#fc929e"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag" style="color:#fc929e">  </span><span class="token tag punctuation" style="color:#657b83">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#657b83">&lt;</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag" style="color:#fc929e"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag" style="color:#fc929e">    </span><span class="token tag attr-name" style="color:#c5a5c5">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#657b83">=</span><span class="token tag script language-javascript punctuation" style="color:#657b83">{</span><span class="token tag script language-javascript punctuation" style="color:#657b83">{</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">backgroundColor</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript string" style="color:#8dc891">&#x27;blue&#x27;</span><span class="token tag script language-javascript punctuation" style="color:#657b83">,</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">height</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript number" style="color:#5a9bcf">20</span><span class="token tag script language-javascript punctuation" style="color:#657b83">,</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript literal-property property" style="color:#2aa198">width</span><span class="token tag script language-javascript operator" style="color:#fc929e">:</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript number" style="color:#5a9bcf">20</span><span class="token tag script language-javascript" style="color:#fc929e"> </span><span class="token tag script language-javascript punctuation" style="color:#657b83">}</span><span class="token tag script language-javascript punctuation" style="color:#657b83">}</span><span class="token tag" style="color:#fc929e"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token tag" style="color:#fc929e">  </span><span class="token tag punctuation" style="color:#657b83">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#657b83">&lt;/</span><span class="token tag class-name" style="color:#fac863">View</span><span class="token tag punctuation" style="color:#657b83">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_R7VQ clean-btn"><span class="copyButtonIcons_Uqyx" aria-hidden="true"><svg class="copyButtonIcon_CtfL" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Mq1p" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>How is this update processed by React Native?</strong></p><p>When a state update occurs, the renderer needs to conceptually update the <em>React Element Tree</em> in order to update the host views that are already mounted. But in order to preserve thread safety, both the <em>React Element Tree</em> as well as the <em>React Shadow Tree</em> must be immutable. This means that instead of mutating the current <em>React Element Tree</em> and <em>React Shadow Tree</em>, React must create a new copy of each tree which incorporates the new props, styles, and children.</p><p>Letâ€™s explore each phase of the render pipeline during a state update.</p><h3 class="anchor anchorWithStickyNavbar_YDjN" id="phase-1-render-1">Phase 1. Render<a class="hash-link" href="#phase-1-render-1" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="Phase one: render" src="/assets/images/phase-one-render-cdd8336227468340a4c6b37d485e5bf8.png" width="1622" height="92" class="img_PFMr"></p><p>When React creates a new <em>React Element Tree</em> that incorporates the new state, it must clone every <em>React Element</em> and <em>React Shadow Node</em> that is impacted by the change. After cloning, the new <em>React Shadow Tree</em> is committed.</p><p>React Native renderer leverages structural sharing to minimize the overhead of immutability. When a <em>React Element</em> is cloned to include the new state, every <em>React Element</em> that is on the path up to the root is cloned. <strong>React will only clone a React Element if it requires an update to its props, style, or children.</strong> Any <em>React Elements</em> that are unchanged by the state update are shared by the old and new trees.</p><p>In the above example, React creates the new tree using these operations:</p><ol><li>CloneNode(<strong>Node 3</strong>, {backgroundColor: &#x27;yellow&#x27;}) â†’ <strong>Node 3&#x27;</strong></li><li>CloneNode(<strong>Node 2</strong>) â†’ <strong>Node 2&#x27;</strong></li><li>AppendChild(<strong>Node 2&#x27;</strong>, <strong>Node 3&#x27;</strong>)</li><li>AppendChild(<strong>Node 2&#x27;</strong>, <strong>Node 4</strong>)</li><li>CloneNode(<strong>Node 1</strong>) â†’ <strong>Node 1&#x27;</strong></li><li>AppendChild(<strong>Node 1&#x27;</strong>, <strong>Node 2&#x27;</strong>)</li></ol><p>After these operations, <strong>Node 1&#x27;</strong> represents the root of the new <em>React Element Tree</em>. Let&#x27;s assign <strong>T</strong> to the â€œpreviously rendered treeâ€ and <strong>T&#x27;</strong> to the â€œnew treeâ€:</p><p><img loading="lazy" alt="Render pipeline 5" src="/assets/images/render-pipeline-5-5c32c125c1752ce394bdb54da364addb.png" width="2040" height="797" class="img_PFMr"></p><p>Notice how <strong>T</strong> and <strong>T&#x27;</strong> both share <strong>Node 4</strong>. Structural sharing improves performance and reduces memory usage.</p><h3 class="anchor anchorWithStickyNavbar_YDjN" id="phase-2-commit-1">Phase 2. Commit<a class="hash-link" href="#phase-2-commit-1" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="Phase two: commit" src="/assets/images/phase-two-commit-bc6267e2319ae0ccfaa52663d36ad48f.png" width="1622" height="92" class="img_PFMr"></p><p>After React creates the new <em>React Element Tree</em> and <em>React Shadow Tree</em>, it must commit them.</p><ul><li><p><strong>Layout Calculation:</strong> Similar to Layout Calculation during <a href="#initial-render">Initial Render</a>. One important difference is that layout calculation may cause shared <em>React Shadow Nodes</em> to be cloned. This can happen because if the parent of a shared <em>React Shadow Node</em> incurs a layout change, the layout of the shared <em>React Shadow Node</em> may also change.</p></li><li><p><strong>Tree Promotion (New Tree â†’ Next Tree):</strong> Similar to Tree Promotion during <a href="#initial-render">Initial Render</a>.</p></li><li><p><strong>Tree Diffing:</strong> This step computes the diff between the â€œpreviously rendered treeâ€ (<strong>T</strong>) and the â€œnext treeâ€ (<strong>T&#x27;</strong>). The result is a list of atomic mutation operations to be performed on <em>host views</em>.</p><ul><li>In the above example, the operations consist of: <code>UpdateView(**Node 3&#x27;**, {backgroundColor: &#x27;â€œyellowâ€œ})</code></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_YDjN" id="phase-3-mount-1">Phase 3. Mount<a class="hash-link" href="#phase-3-mount-1" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="Phase three: mount" src="/assets/images/phase-three-mount-3544340fff87101e0f7815560061fec7.png" width="1622" height="92" class="img_PFMr"></p><ul><li><strong>Tree Promotion (Next Tree â†’ Rendered Tree)</strong>: This step atomically promotes the â€œnext treeâ€ to â€œpreviously rendered treeâ€ so that the next mount phase computes a diff against the proper tree.
Diff can be calculated for any currently mounted tree with any new tree. The renderer can skip some intermediate versions of the tree.</li><li><strong>View Mounting</strong>: This step applies the atomic mutation operations onto corresponding <em>host views</em>. In the above example, only the <code>backgroundColor</code> of <strong>View 3</strong> will be updated (to yellow).</li></ul><p><img loading="lazy" alt="Render pipeline 6" src="/assets/images/render-pipeline-6-dabe7cbda658efec9aeb1ad3be75b72c.png" width="2038" height="798" class="img_PFMr"></p><hr><h2 class="anchor anchorWithStickyNavbar_YDjN" id="react-native-renderer-state-updates">React Native Renderer State Updates<a class="hash-link" href="#react-native-renderer-state-updates" title="Direct link to heading">â€‹</a></h2><p>For most information in the <em>Shadow Tree</em>, React is the single owner and single source of truth. All data originates from React and there is a single-direction flow of data.</p><p>However, there is one exception and important mechanism: components in C++ can contain state that is not directly exposed to JavaScript, and JavaScript is not the source of truth. C++ and <em>Host Platform</em> control this <em>C++ State</em>. Generally, this is only relevant if you are developing a complicated <em>Host Component</em> that needs <em>C++ State</em>. The vast majority of <em>Host Components</em> do not need this functionality.</p><p>For example, <code>ScrollView</code> uses this mechanism to let the renderer know whatâ€™s the current offset. The update is triggered from the <em>host platform</em>, specifically from the host view that represents the <code>ScrollView</code> component. The information about offset is used in an API like <a href="https://reactnative.dev/docs/direct-manipulation#measurecallback" target="_blank" rel="noopener noreferrer">measure</a>. Since this update stems from the host platform, and does not affect the React Element Tree, this state data is held by <em>C++ State</em>.</p><p>Conceptually, <em>C++ State</em> updates are similar to the <a href="/architecture/render-pipeline#react-state-updates">React State Updates</a> described above.
With two important differences:</p><ol><li>They skip the â€œrender phaseâ€ since React is not involved.</li><li>The updates can originate and happen on any thread, including the main thread.</li></ol><h3 class="anchor anchorWithStickyNavbar_YDjN" id="phase-2-commit-2">Phase 2. Commit<a class="hash-link" href="#phase-2-commit-2" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="Phase two: commit" src="/assets/images/phase-two-commit-bc6267e2319ae0ccfaa52663d36ad48f.png" width="1622" height="92" class="img_PFMr"></p><p>When performing a <em>C++ State</em> update, a block of code requests an update of a <code>ShadowNode</code> (<strong>N</strong>) to set <em>C++ State</em> to value <strong>S</strong>. React Native renderer will repeatedly attempt to get the latest committed version of <strong>N</strong>, clone it with a new state <strong>S</strong>, and commit <strong>Nâ€™</strong> to the tree. If React, or another <em>C++ State</em> update, has performed another commit during this time, the <em>C++ State</em> commit will fail and the renderer will retry the <em>C++ State</em> update many times until a commit succeeds. This prevents source-of-truth collisions and races.</p><h3 class="anchor anchorWithStickyNavbar_YDjN" id="phase-3-mount-2">Phase 3. Mount<a class="hash-link" href="#phase-3-mount-2" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="Phase three: mount" src="/assets/images/phase-three-mount-3544340fff87101e0f7815560061fec7.png" width="1622" height="92" class="img_PFMr"></p><p>The <em>Mount Phase</em> is practically identical to the <a href="#react-state-updates">Mount Phase of React State Updates</a>. The renderer still needs to recompute layout perform a tree diff, etc. See above sections for details.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/react-native-website/blob/master/website/architecture/render-pipeline.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_OMbO" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vA0S"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/architecture/fabric-renderer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Fabric</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/architecture/xplat-implementation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cross Platform Implementation</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#initial-render" class="table-of-contents__link toc-highlight">Initial Render</a><ul><li><a href="#phase-1-render" class="table-of-contents__link toc-highlight">Phase 1. Render</a></li><li><a href="#phase-2-commit" class="table-of-contents__link toc-highlight">Phase 2. Commit</a></li><li><a href="#phase-3-mount" class="table-of-contents__link toc-highlight">Phase 3. Mount</a></li></ul></li><li><a href="#react-state-updates" class="table-of-contents__link toc-highlight">React State Updates</a><ul><li><a href="#phase-1-render-1" class="table-of-contents__link toc-highlight">Phase 1. Render</a></li><li><a href="#phase-2-commit-1" class="table-of-contents__link toc-highlight">Phase 2. Commit</a></li><li><a href="#phase-3-mount-1" class="table-of-contents__link toc-highlight">Phase 3. Mount</a></li></ul></li><li><a href="#react-native-renderer-state-updates" class="table-of-contents__link toc-highlight">React Native Renderer State Updates</a><ul><li><a href="#phase-2-commit-2" class="table-of-contents__link toc-highlight">Phase 2. Commit</a></li><li><a href="#phase-3-mount-2" class="table-of-contents__link toc-highlight">Phase 3. Mount</a></li></ul></li></ul><div class="wwads-cn wwads-vertical" data-id="58" style="max-width:200px;margin-top:20px"></div> </div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">React Native ä¸­æ–‡ç½‘ Â© 2022 æ­¦æ±‰é’ç½—ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸
      <a style="margin-left:10px" href="http://beian.miit.gov.cn/">é„‚ICPå¤‡20002031å·-3</a>
      <img style="width:25px" src="//img.alicdn.com/tfs/TB1..50QpXXXXX7XpXXXXXXXXXX-40-40.png" alt="é„‚å…¬ç½‘å®‰å¤‡ 42011202001821å·">
      <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42011202001821">é„‚å…¬ç½‘å®‰å¤‡ 42011202001821å·</a>
      </div></div></div></footer></div>
<script src="/assets/js/runtime~main.b02afa69.js"></script>
<script src="/assets/js/main.3b25dbd5.js"></script>
</body>
</html>